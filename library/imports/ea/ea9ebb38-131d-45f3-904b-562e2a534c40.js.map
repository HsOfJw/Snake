{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\scene/assets\\scripts\\scene\\LogoScene.js"],"names":["WXHelper","require","SceneCom","Util","GameRes","cc","Class","extends","properties","jwLogo","default","type","Node","gameAdBg","isCalled","onLoad","loadRes","GetSystemInfo","getLaunchOptionsSync","i","StartSceneRes","length","res","loader","err","texture","log","self","window","wx","undefined","onShow","console","query","game_id","GameConfig","GameID","showJWLogo","wx_onLaunch","gid","Game","GlobalVar","GameAdGID","active","getGameAd","td_id","SendMessage","SendGetGameAdMessage","data","GameAdInfo","bgUrl","img","loadRemoteImg","on","EventType","TOUCH_END","logoClicked","bind","status","state","ToMiniProgram","envVersion","success","fail","app_id","AppID","appId","extraData","param","path","hz_app_id","hz_path","navigateToMiniProgram","scheduleOnce","juLogoFinish","JWLogoDuration","SceneMgr","switchScene","SceneType","StartScene","onDestroy"],"mappings":"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","file":"LogoScene.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\scene","sourcesContent":["\r\nvar WXHelper = require(\"WXHelper\");\r\nvar SceneCom = require(\"SceneCom\");\r\nvar Util = require(\"Util\");\r\nvar GameRes = require(\"GameRes\");\r\n\r\ncc.Class({\r\n    extends: SceneCom,\r\n\r\n    properties: {\r\n        //巨网logo\r\n        jwLogo: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n        gameAdBg: {\r\n            default: null,\r\n            type: cc.Node,\r\n        }\r\n    },\r\n\r\n    isCalled: null,\r\n\r\n    onLoad () {\r\n        this.isCalled = false;\r\n\r\n        this.loadRes();\r\n\r\n        WXHelper.GetSystemInfo();\r\n\r\n        this.getLaunchOptionsSync();\r\n    },\r\n\r\n    loadRes(){\r\n        for(var i = 0;i < GameRes.StartSceneRes.length;i ++){\r\n            var res = GameRes.StartSceneRes[i];\r\n            cc.loader.loadRes(res, function (err, texture) {\r\n                if(err){\r\n                    cc.log(err);\r\n                }else{\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    //获取启动参数\r\n    getLaunchOptionsSync() {\r\n        var self = this;\r\n\r\n        if (window.wx != undefined) {\r\n            \r\n            wx.onShow(res => {//监听小游戏回到前台的事件\r\n                    console.log('onshow', res.query);\r\n                    if (res.query.game_id == GameConfig.GameID) {\r\n                        //跳到自己的游戏\r\n                        console.log(\"[loading] 游戏返回到前台的参数中  跳转到自己的游戏中\");\r\n                        self.showJWLogo();\r\n                    }\r\n                }\r\n            );\r\n\r\n            let wx_onLaunch = wx.getLaunchOptionsSync();\r\n\r\n            console.log(wx_onLaunch);\r\n\r\n            let gid = wx_onLaunch.query.gid;\r\n            if (gid) {\r\n                console.log(\"开始走非正常流程\");\r\n                Game.GlobalVar.GameAdGID = gid;\r\n                this.jwLogo.active = false;\r\n                this.getGameAd(gid);\r\n                return;\r\n            }else if (wx_onLaunch.query.td_id) {\r\n                //存储td_id  程序获取到uid的时候 发送请求\r\n                Game.GlobalVar.td_id = wx_onLaunch.query.td_id;\r\n            }\r\n        }\r\n        //显示巨网logo\r\n        this.showJWLogo();\r\n    },\r\n\r\n    //获取游戏广告\r\n    getGameAd(gid) {\r\n        let self = this;\r\n        if (window.wx != undefined) {\r\n            Game.SendMessage.SendGetGameAdMessage(gid, function(data){\r\n                Game.GlobalVar.GameAdInfo = data;\r\n                let bgUrl = data.img;\r\n                Util.loadRemoteImg(self.gameAdBg, bgUrl);\r\n                self.gameAdBg.active = true;\r\n                self.gameAdBg.on(cc.Node.EventType.TOUCH_END,self.logoClicked.bind(self));\r\n            });\r\n        }\r\n    },\r\n\r\n    //落地页点击\r\n    logoClicked(){\r\n        if (!Game.GlobalVar.GameAdInfo) {\r\n            return\r\n        }\r\n\r\n        let self = this;\r\n\r\n        let status = Game.GlobalVar.GameAdInfo.state;\r\n\r\n        let ToMiniProgram = {\r\n            envVersion: 'release',\r\n            success: function () {\r\n                console.log(\"跳转成功\", Game.GlobalVar.GameAdGID);\r\n                self.showJWLogo();\r\n            },\r\n            fail: function (res) {\r\n                console.log(\"跳转失败\", res);\r\n                self.showJWLogo();\r\n            },\r\n        };\r\n\r\n        if (status == 1) {//审核中  跳到游戏\r\n            if(Game.GlobalVar.GameAdInfo.app_id == GameConfig.AppID){\r\n                self.showJWLogo();\r\n                return;\r\n            }\r\n            ToMiniProgram.appId = Game.GlobalVar.GameAdInfo.app_id;\r\n            ToMiniProgram.extraData = Game.GlobalVar.GameAdInfo.param;\r\n            ToMiniProgram.path = Game.GlobalVar.GameAdInfo.path;\r\n            console.log(\"跳转到游戏中\");\r\n        } else if (status == 2) {//通过审核 跳盒子\r\n            console.log(\"跳转到盒子中\");\r\n            ToMiniProgram.appId = Game.GlobalVar.GameAdInfo.hz_app_id;\r\n            ToMiniProgram.path = Game.GlobalVar.GameAdInfo.hz_path;\r\n            ToMiniProgram.extraData = {gid: Game.GlobalVar.GameAdGID};\r\n        }\r\n        if (window.wx != undefined) {\r\n            wx.navigateToMiniProgram(ToMiniProgram);\r\n        }\r\n    },\r\n\r\n    showJWLogo(){\r\n        // cc.director.preloadScene('GameScene');\r\n        if(this.jwLogo){\r\n            this.jwLogo.active = true;\r\n            if(this.isCalled == false){\r\n                this.isCalled = true;\r\n                this.scheduleOnce(this.juLogoFinish.bind(this), GameConfig.JWLogoDuration);\r\n            }\r\n        }\r\n        if(this.gameAdBg){\r\n            this.gameAdBg.active = false;\r\n        }\r\n\r\n    },\r\n\r\n    juLogoFinish(){\r\n        Game.SceneMgr.switchScene(Game.SceneType.StartScene);\r\n    },\r\n\r\n    onDestroy(){\r\n    }\r\n});\r\n"]}