{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\MoveComponent.js"],"names":["MoveDirection","require","MoveComponent","cc","Class","extends","Component","isMoving","ctor","self","startMove","node","nextGID","doTransfrom","gid","tiledwidth","Game","MapUtil","GetMapBlockSize","width","newPos","getNewPos","moveTo","GameConfig","SnakeMoveSpeed","sequence","callFunc","moveFinish","runAction","frameOnMove","dt","myChangedDirtyFlag","setMyChangedDirtyFlag"],"mappings":";;;;;;AAAA,IAAIA,gBAAgBC,QAAQ,aAAR,EAAuBD,aAA3C;;AAEA,IAAIE,gBAAgBC,GAAGC,KAAH,CAAS;;AAEzBC,aAASF,GAAGG,SAFa;;AAIzBC,cAAU,IAJe;;AAMzBC,QANyB,kBAMnB;AACF,YAAIC,OAAO,IAAX;;AAEA,aAAKF,QAAL,GAAgB,KAAhB;AACH,KAVwB;AAYzBG,aAZyB,uBAYd;AACP,YAAG,KAAKH,QAAR,EAAiB;AACb;AACH;AACD,YAAG,CAAC,KAAKI,IAAT,EAAc;AACV;AACH;;AAED,YAAG,KAAKA,IAAL,CAAUC,OAAV,GAAoB,CAAvB,EAAyB;AACrB;AACH;;AAED,YAAIH,OAAO,IAAX;;AAEA,aAAKF,QAAL,GAAgB,IAAhB;;AAEA;AACA;AACA;AACA,YAAGE,KAAKE,IAAL,CAAUE,WAAb,EAAyB;AACrBJ,iBAAKE,IAAL,CAAUE,WAAV;AACH;;AAED,YAAGJ,KAAKE,IAAL,CAAUD,SAAb,EAAuB;AACnBD,iBAAKE,IAAL,CAAUD,SAAV;AACH;;AAED,YAAII,MAAM,KAAKH,IAAL,CAAUC,OAApB;;AAEA,YAAIG,aAAaC,KAAKC,OAAL,CAAaC,eAAb,GAA+BC,KAAhD;AACA,YAAIC,SAAS,KAAKT,IAAL,CAAUU,SAAV,CAAoBP,GAApB,CAAb;;AAEA,YAAIQ,SAAS,IAAInB,GAAGmB,MAAP,CAAcC,WAAWC,cAAzB,EAAyCJ,MAAzC,CAAb;AACA,YAAIK,WAAW,IAAItB,GAAGsB,QAAP,CAAgBH,MAAhB,EAAwBnB,GAAGuB,QAAH,CAAY,YAAU;AACzDjB,iBAAKkB,UAAL;AACH,SAFsC,CAAxB,CAAf;AAGA,aAAKhB,IAAL,CAAUiB,SAAV,CAAoBH,QAApB;AACA,aAAKd,IAAL,CAAUG,GAAV,GAAgBA,GAAhB;AACH,KAlDwB;AAoDzBa,cApDyB,wBAoDb;AACR,aAAKhB,IAAL,CAAUgB,UAAV;;AAEA,aAAKpB,QAAL,GAAgB,KAAhB;AACH,KAxDwB;AA0DzBsB,eA1DyB,uBA0DbC,EA1Da,EA0DV;AACX,YAAG,KAAKnB,IAAL,CAAUoB,kBAAb,EAAgC;AAC5B,iBAAKrB,SAAL;;AAEA,iBAAKC,IAAL,CAAUqB,qBAAV,CAAgC,KAAhC;AACH;AACJ;AAhEwB,CAAT,CAApB","file":"MoveComponent.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["var MoveDirection = require('ConstDefine').MoveDirection;\r\n\r\nvar MoveComponent = cc.Class({\r\n\r\n    extends: cc.Component,\r\n\r\n    isMoving: null,\r\n\r\n    ctor(){\r\n        var self = this;\r\n\r\n        this.isMoving = false;\r\n    },\r\n\r\n    startMove(){\r\n        if(this.isMoving){\r\n            return;\r\n        }\r\n        if(!this.node){\r\n            return;\r\n        }\r\n\r\n        if(this.node.nextGID < 0){\r\n            return;\r\n        }\r\n\r\n        var self = this;\r\n\r\n        this.isMoving = true;\r\n\r\n        //先转动身体\r\n        // self.node.setDirection(Game.curOpDir);\r\n        // self.node.doRotateAction();\r\n        if(self.node.doTransfrom){\r\n            self.node.doTransfrom();\r\n        }\r\n        \r\n        if(self.node.startMove){\r\n            self.node.startMove();\r\n        }\r\n\r\n        var gid = this.node.nextGID;\r\n\r\n        var tiledwidth = Game.MapUtil.GetMapBlockSize().width;\r\n        var newPos = this.node.getNewPos(gid);\r\n\r\n        var moveTo = new cc.moveTo(GameConfig.SnakeMoveSpeed, newPos);\r\n        var sequence = new cc.sequence(moveTo, cc.callFunc(function(){\r\n            self.moveFinish();\r\n        }));\r\n        this.node.runAction(sequence);\r\n        this.node.gid = gid;\r\n    },\r\n\r\n    moveFinish(){\r\n        this.node.moveFinish();\r\n\r\n        this.isMoving = false;\r\n    },\r\n\r\n    frameOnMove(dt){\r\n        if(this.node.myChangedDirtyFlag){\r\n            this.startMove();\r\n\r\n            this.node.setMyChangedDirtyFlag(false);\r\n        }\r\n    }\r\n});\r\n"]}