{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\scene/assets\\scripts\\scene\\StartScene.js"],"names":["LevelData","require","WXHelper","GameRes","SceneCom","AdvertiseMgr","AdvertiseConfig","cc","Class","extends","properties","musicBtn","default","type","Node","vibrationBtn","ranklistBtn","shareBtn","startBtn","moreGame","cblBtn","cblPrefab","Prefab","musicBtnState","vibrationBtnState","onLoad","self","on","EventType","TOUCH_END","event","moreGameBtnClicked","musicBtnClicket","vibrationBtnClick","ranklistBtnClicked","shareBtnClicked","startBtnClicked","cblBtnClicked","levelData","ReadLevelData","UploadUserCloudStorage","GenerateUserCloudData","DisposeUnusualData","Game","SendMessage","SendGetConfigMessage","start","userid","GameLocalData","ReadUserID","IsWXContext","active","CreateUserInfoButton","res","login","state","resCode","loginComplete","SendLogin","iv","encryptedData","resData","data","uid","GlobalVar","userID","_insertDataToServer","CreateBannerAd","ADConfig_HomePage_Bottom","AudioManager","playBackgroundSound","td_id","request","user_id","console","log","onMessage","NetManager","sendMsg","GameConfig","LoginAddr","cblNode","instantiate","node","addChild","playButtonSound","MoreGame","DestroyBannerAd","SceneMgr","switchScene","SceneType","RanklistScene","Share","refreshMusicBtnState","refreshVibrationBtnState","musicSprite","getComponent","Sprite","closeSound","spriteFrame","setTexture","url","raw","openSound","vibrationSprite","callback","DebugMode","ClearUserID","Login","DestroyUserInfoBtn","SaveUserID","SelectScene","onDestroy"],"mappings":"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","file":"StartScene.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\scene","sourcesContent":["var LevelData = require(\"LevelData\");\r\nvar WXHelper = require(\"WXHelper\");\r\nvar GameRes = require(\"GameRes\");\r\nvar SceneCom = require(\"SceneCom\");\r\nvar AdvertiseMgr = require(\"AdvertiseMgr\");\r\nvar AdvertiseConfig = require(\"AdvertiseConfig\");\r\n\r\ncc.Class({\r\n    extends: SceneCom,\r\n\r\n    properties: {\r\n        musicBtn: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        vibrationBtn: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        ranklistBtn: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        shareBtn: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        startBtn: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        //更多游戏按钮\r\n        moreGame: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n        cblBtn: cc.Node,\r\n\r\n        cblPrefab: cc.Prefab,\r\n    },\r\n\r\n    musicBtnState: null,\r\n\r\n    vibrationBtnState: null,\r\n\r\n    onLoad() {\r\n        var self = this;\r\n\r\n        this.musicBtnState = 1;\r\n        this.vibrationBtnState = 1;\r\n\r\n        this.moreGame.on(cc.Node.EventType.TOUCH_END, function (event) {\r\n            self.moreGameBtnClicked();\r\n        });\r\n\r\n        this.musicBtn.on(cc.Node.EventType.TOUCH_END, function (event) {\r\n            self.musicBtnClicket();\r\n        });\r\n\r\n        this.vibrationBtn.on(cc.Node.EventType.TOUCH_END, function (event) {\r\n            self.vibrationBtnClick();\r\n        });\r\n\r\n        this.ranklistBtn.on(cc.Node.EventType.TOUCH_END, function (event) {\r\n            self.ranklistBtnClicked();\r\n        });\r\n\r\n        this.shareBtn.on(cc.Node.EventType.TOUCH_END, function (event) {\r\n            self.shareBtnClicked();\r\n        });\r\n\r\n        this.startBtn.on(cc.Node.EventType.TOUCH_END, function (event) {\r\n            self.startBtnClicked();\r\n        });\r\n\r\n        this.cblBtn.on(cc.Node.EventType.TOUCH_END, function () {\r\n            self.cblBtnClicked();\r\n        });\r\n\r\n        var levelData = LevelData.ReadLevelData();\r\n        WXHelper.UploadUserCloudStorage(LevelData.GenerateUserCloudData());\r\n        LevelData.DisposeUnusualData();\r\n\r\n        //获取配置\r\n        Game.SendMessage.SendGetConfigMessage();\r\n    },\r\n\r\n    start() {\r\n        var self = this;\r\n\r\n        var userid = GameLocalData.ReadUserID();\r\n\r\n        if (WXHelper.IsWXContext() && userid == null) {\r\n\r\n            this.startBtn.active = false;\r\n\r\n            WXHelper.CreateUserInfoButton(function (res) {\r\n\r\n                self.login(function (state, resCode) {\r\n                    if (state == 1) {\r\n                        var userid = GameLocalData.ReadUserID();\r\n                        self.loginComplete(userid);\r\n                    } else if (state == 2) {\r\n                        Game.SendMessage.SendLogin(resCode, res.iv, res.encryptedData, function (resData) {\r\n                            self.loginComplete(resData.data.uid);\r\n                        });\r\n                    } else if (state == 3) {\r\n                        //失败\r\n                        self.loginComplete(-1);\r\n                    }\r\n                });\r\n            });\r\n        } else {\r\n            Game.GlobalVar.userID = userid;\r\n            this._insertDataToServer();\r\n            this.startBtn.active = true;\r\n        }\r\n\r\n        //创建广告\r\n        AdvertiseMgr.CreateBannerAd(AdvertiseConfig.ADConfig_HomePage_Bottom);\r\n\r\n        Game.AudioManager.playBackgroundSound();\r\n    },\r\n    //平台数据插入\r\n    _insertDataToServer: function () {\r\n        if (Game.GlobalVar.td_id) {\r\n            var request = {\r\n                user_id: Game.GlobalVar.userID,\r\n                td_id: Game.GlobalVar.td_id,\r\n\r\n            };\r\n            console.log(\"发送登陆的消息: \", request);\r\n\r\n            var onMessage = function (data) {\r\n                console.log(\"平台数据插入返回的数据为\", data);\r\n            };\r\n\r\n            Game.NetManager.sendMsg(\"GET\", Game.GameConfig.LoginAddr, request, onMessage);\r\n        }\r\n\r\n    },\r\n\r\n    cblBtnClicked() {\r\n        if (this.cblPrefab) {\r\n            var cblNode = cc.instantiate(this.cblPrefab);\r\n            this.node.addChild(cblNode, 1000);\r\n        }\r\n    },\r\n\r\n    //更多游戏点击\r\n    moreGameBtnClicked() {\r\n        Game.AudioManager.playButtonSound();\r\n\r\n        WXHelper.MoreGame();\r\n    },\r\n\r\n    startBtnClicked() {\r\n        var userid = GameLocalData.ReadUserID();\r\n\r\n        if (WXHelper.IsWXContext()) {\r\n            this.loginComplete(userid, 1);\r\n        } else {\r\n            this.loginComplete(19951214, 1);\r\n        }\r\n    },\r\n\r\n    ranklistBtnClicked() {\r\n        Game.AudioManager.playButtonSound();\r\n\r\n        AdvertiseMgr.DestroyBannerAd();\r\n\r\n        Game.SceneMgr.switchScene(Game.SceneType.RanklistScene);\r\n    },\r\n\r\n    shareBtnClicked() {\r\n        Game.AudioManager.playButtonSound();\r\n\r\n        WXHelper.Share();\r\n    },\r\n\r\n    musicBtnClicket() {\r\n        Game.AudioManager.playButtonSound();\r\n\r\n        if (this.musicBtnState == 0) {\r\n            this.musicBtnState = 1;\r\n        } else {\r\n            this.musicBtnState = 0;\r\n        }\r\n\r\n        this.refreshMusicBtnState();\r\n    },\r\n\r\n    vibrationBtnClick() {\r\n        Game.AudioManager.playButtonSound();\r\n\r\n        if (this.vibrationBtnState == 0) {\r\n            this.vibrationBtnState = 1;\r\n        } else {\r\n            this.vibrationBtnState = 0;\r\n        }\r\n\r\n        this.refreshVibrationBtnState();\r\n    },\r\n\r\n    refreshMusicBtnState() {\r\n        var musicSprite = this.musicBtn.getComponent(cc.Sprite);\r\n\r\n        if (musicSprite) {\r\n            if (this.musicBtnState == 0) {\r\n                Game.AudioManager.closeSound();\r\n                musicSprite.spriteFrame.setTexture(cc.url.raw('resources/EffectOff.png'));\r\n            } else {\r\n                Game.AudioManager.openSound();\r\n                musicSprite.spriteFrame.setTexture(cc.url.raw('resources/EffectOn.png'));\r\n            }\r\n        }\r\n    },\r\n\r\n    refreshVibrationBtnState() {\r\n        var vibrationSprite = this.vibrationBtn.getComponent(cc.Sprite);\r\n\r\n        if (vibrationSprite) {\r\n            if (this.vibrationBtnState == 0) {\r\n                vibrationSprite.spriteFrame.setTexture(cc.url.raw('resources/VibrationOff.png'));\r\n            } else {\r\n                vibrationSprite.spriteFrame.setTexture(cc.url.raw('resources/VibrationOn.png'));\r\n            }\r\n        }\r\n    },\r\n\r\n    login(callback) {\r\n        var self = this;\r\n\r\n        if (GameConfig.DebugMode) {\r\n            GameLocalData.ClearUserID();\r\n        }\r\n\r\n        WXHelper.Login(callback);\r\n    },\r\n\r\n    loginComplete(userid) {\r\n        cc.log(\"loginComplete-->>>userid = \", userid);\r\n\r\n        AdvertiseMgr.DestroyBannerAd();\r\n\r\n        Game.AudioManager.playButtonSound();\r\n\r\n        if (userid && userid >= 0) {\r\n            WXHelper.DestroyUserInfoBtn();\r\n\r\n            Game.GlobalVar.userID = userid;\r\n\r\n            this._insertDataToServer();\r\n            GameLocalData.SaveUserID(userid);\r\n\r\n            Game.SceneMgr.switchScene(Game.SceneType.SelectScene);\r\n        }\r\n    },\r\n\r\n    onDestroy() {\r\n        // Game.AudioManager.stopBackgroundSound();\r\n    }\r\n});\r\n"]}