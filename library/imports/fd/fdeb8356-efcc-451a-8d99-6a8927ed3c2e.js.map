{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\DropComponent.js"],"names":["Util","require","MoveDirection","DropComponent","cc","Class","extends","Component","droping","ctor","self","checkDrop","node","isWin","isFloated","startDrop","allGID","getAllGID","length","terrainGidVec","Game","MapUtil","GetMapTerrainGID","i","downGID","GetDownGID","IsContainElement","IsNull","name","snakeGID","GetSnakeGID","GlobalVar","isStoneDroping","doDropAction","dropFinish","frameOnMove","dt","myDropDirtyFlag","setMyDropDirtyFlag"],"mappings":";;;;;;AAAA,IAAIA,OAAOC,QAAQ,MAAR,CAAX;AACA,IAAIC,gBAAgBD,QAAQ,aAAR,EAAuBC,aAA3C;;AAEA,IAAIC,gBAAgBC,GAAGC,KAAH,CAAS;;AAEzBC,aAASF,GAAGG,SAFa;;AAIzBC,aAAS,IAJgB;;AAMzBC,QANyB,kBAMnB;AACF,YAAIC,OAAO,IAAX;;AAEA,aAAKF,OAAL,GAAe,KAAf;AACH,KAVwB;AAYzBG,aAZyB,uBAYd;AACP,YAAG,KAAKC,IAAL,CAAUC,KAAb,EAAmB;AACf;AACH;AACD,YAAG,KAAKL,OAAR,EAAgB;AACZ;AACH;AACD,YAAG,KAAKM,SAAL,EAAH,EAAoB;AAChB,iBAAKC,SAAL;AACH;AACJ,KAtBwB;AAwBzBD,aAxByB,uBAwBd;AACP,YAAIE,SAAS,KAAKJ,IAAL,CAAUK,SAAV,EAAb;AACA,YAAGD,OAAOE,MAAP,IAAiB,CAApB,EAAsB;AAClB,mBAAO,KAAP;AACH;;AAED,YAAIC,gBAAgBC,KAAKC,OAAL,CAAaC,gBAAb,EAApB;;AAEA,aAAI,IAAIC,IAAI,CAAZ,EAAcA,IAAIP,OAAOE,MAAzB,EAAgCK,GAAhC,EAAqC;AACjC,gBAAIC,UAAUJ,KAAKC,OAAL,CAAaI,UAAb,CAAwBT,OAAOO,CAAP,CAAxB,CAAd;AACA,gBAAGvB,KAAK0B,gBAAL,CAAsBP,aAAtB,EAAqCK,OAArC,KAAiDJ,KAAKC,OAAL,CAAaM,MAAb,CAAoBH,OAApB,KAAgC,KAApF,EAA0F;AACtF,uBAAO,KAAP;AACH;AACJ;;AAED,YAAG,KAAKZ,IAAL,CAAUgB,IAAV,IAAkB,WAArB,EAAiC;AAC7B,gBAAIC,WAAWT,KAAKC,OAAL,CAAaS,WAAb,EAAf;AACA,iBAAI,IAAIP,IAAI,CAAZ,EAAcA,IAAIP,OAAOE,MAAzB,EAAgCK,GAAhC,EAAqC;AACjC,oBAAIC,UAAUJ,KAAKC,OAAL,CAAaI,UAAb,CAAwBT,OAAOO,CAAP,CAAxB,CAAd;AACA,oBAAGvB,KAAK0B,gBAAL,CAAsBG,QAAtB,EAAgCL,OAAhC,CAAH,EAA4C;AACxC,2BAAO,KAAP;AACH;AACJ;AACJ;AACD,eAAO,IAAP;AACH,KAjDwB;AAmDzBT,aAnDyB,uBAmDd;AACP,YAAG,CAAC,KAAKH,IAAT,EAAc;AACV;AACH;AACD,YAAIF,OAAO,IAAX;;AAEA,aAAKF,OAAL,GAAe,IAAf;AACA,YAAG,KAAKI,IAAL,CAAUgB,IAAV,IAAkB,WAArB,EAAiC;AAC7BR,iBAAKW,SAAL,CAAeC,cAAf,GAAgC,IAAhC;AACH;;AAED,aAAKpB,IAAL,CAAUqB,YAAV;AACH,KA/DwB;AAiEzBC,cAjEyB,wBAiEb;AACR,aAAK1B,OAAL,GAAe,KAAf;AACH,KAnEwB;AAqEzB2B,eArEyB,uBAqEZC,EArEY,EAqER;AACb,YAAG,KAAKxB,IAAL,CAAUyB,eAAb,EAA6B;AACzB,iBAAK1B,SAAL;;AAEA,iBAAKC,IAAL,CAAU0B,kBAAV,CAA6B,KAA7B;AACH;AACJ;AA3EwB,CAAT,CAApB","file":"DropComponent.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["var Util = require(\"Util\");\r\nvar MoveDirection = require('ConstDefine').MoveDirection;\r\n\r\nvar DropComponent = cc.Class({\r\n\r\n    extends: cc.Component,\r\n\r\n    droping: null,\r\n\r\n    ctor(){\r\n        var self = this;\r\n\r\n        this.droping = false;\r\n    },\r\n\r\n    checkDrop(){\r\n        if(this.node.isWin){\r\n            return;\r\n        }\r\n        if(this.droping){\r\n            return;\r\n        }\r\n        if(this.isFloated()){\r\n            this.startDrop();\r\n        }\r\n    },\r\n\r\n    isFloated(){\r\n        var allGID = this.node.getAllGID();\r\n        if(allGID.length <= 0){\r\n            return false;\r\n        }\r\n\r\n        var terrainGidVec = Game.MapUtil.GetMapTerrainGID();\r\n\r\n        for(var i = 0;i < allGID.length;i ++){\r\n            var downGID = Game.MapUtil.GetDownGID(allGID[i]);\r\n            if(Util.IsContainElement(terrainGidVec, downGID) || Game.MapUtil.IsNull(downGID) == false){\r\n                return false;\r\n            }\r\n        }\r\n\r\n        if(this.node.name == \"StoneNode\"){\r\n            var snakeGID = Game.MapUtil.GetSnakeGID();\r\n            for(var i = 0;i < allGID.length;i ++){\r\n                var downGID = Game.MapUtil.GetDownGID(allGID[i]);\r\n                if(Util.IsContainElement(snakeGID, downGID)){\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n        return true;\r\n    },\r\n\r\n    startDrop(){\r\n        if(!this.node){\r\n            return;\r\n        }\r\n        var self = this;\r\n\r\n        this.droping = true;\r\n        if(this.node.name == \"StoneNode\"){\r\n            Game.GlobalVar.isStoneDroping = true;\r\n        }\r\n\r\n        this.node.doDropAction();\r\n    },\r\n\r\n    dropFinish(){\r\n        this.droping = false;\r\n    },\r\n\r\n    frameOnMove (dt) {\r\n        if(this.node.myDropDirtyFlag){\r\n            this.checkDrop();\r\n\r\n            this.node.setMyDropDirtyFlag(false);\r\n        }\r\n    }\r\n});"]}