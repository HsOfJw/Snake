{"version":3,"sources":["MapUtil.js"],"names":["window","Game","MoveDirection","require","Util","MapUtil","MapNode","MapSize","MapBlockSize","MapBlockNum","MapTerrainGID","DoorGID","AppleGID","DiCiGID","StoneGID","SnakeGID","StartGID","Init","mapNode","getTileSize","getMapSize","cc","size","node","width","height","InitAppleGID","InitDiCiGIDVec","InitDoorGID","InitStartGID","InitStoneGIDVec","InitTerrainGidVec","InitEnd","Reset","length","allLayers","i","layer","allTiles","getTiles","j","push","index","gid","getGIDByName","direction","gidobj","headGID","bodyGID","tailGID","IsNull","IsContainElement","RemoveTiled","tid","ConvertGIDToTID","removeTileAt","GetTiledSpriteFrame","sprite","getTileAt","img_id","getTileGIDAt","color","Color","url","getTexture","spriteFrame","SpriteFrame","Rect","pos","ConvertGIDToPos","p","x","y","ConvertMapYToCanvasY","mapY","ConvertTIDToGID","parseInt","ConvertPosToTid","tidX","tidY","ConvertMapPosToGID","anchropoint","posX","posY","GetMapTerrainGID","GetNextGID","moveDirection","curGID","nextTid","MD_Left","MD_Right","MD_Up","MD_Down","RemoveAppleGID","appleGID","splice","GetMapBlockNum","GetMapBlockSize","GetLeftGID","GetRightGID","GetUpGID","GetDownGID","GetDoorGID","GetAppleGID","GetStartGID","GetAllStoneGID","GetSnakeGID","GetDiCiGID","GetProperty","objname","propertyname","getProperty","UpdateStoneGID","allStoneGID","UpdateSnakeGID","snakeGID","name","objLayer","getObjectGroup","posObj","getObject","obj","property"],"mappings":"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","file":"MapUtil.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["window.Game = window.Game || {};\r\n\r\nvar MoveDirection = require('ConstDefine').MoveDirection;\r\nvar Util = require('Util');\r\n\r\nGame.MapUtil = {\r\n\r\n    //地图节点\r\n    MapNode: null,\r\n\r\n    //地图的尺寸\r\n    MapSize: null,\r\n\r\n    //地图块的尺寸\r\n    MapBlockSize: null,\r\n\r\n    //地图横向和纵向地图块的个数\r\n    MapBlockNum: null,\r\n\r\n    //地图上所有地形的GID\r\n    MapTerrainGID: null,\r\n\r\n    //门的GID\r\n    DoorGID: null,\r\n\r\n    //苹果的GID\r\n    AppleGID: null,\r\n\r\n    //所有地刺的GID\r\n    DiCiGID: null,\r\n\r\n    //所有石头的GID\r\n    StoneGID: null,\r\n\r\n    //蛇包含的所有GID\r\n    SnakeGID: null,\r\n\r\n    //出生点的GID\r\n    StartGID: null,\r\n    \r\n    Init: function(mapNode){\r\n        this.MapNode = mapNode;\r\n        this.MapBlockSize = mapNode.getTileSize();\r\n        this.MapBlockNum = mapNode.getMapSize();\r\n        this.MapSize = cc.size(mapNode.node.width, mapNode.node.height);\r\n\r\n        this.InitAppleGID();\r\n        this.InitDiCiGIDVec();\r\n        this.InitDoorGID();\r\n        this.InitStartGID();\r\n        this.InitStoneGIDVec();\r\n        this.InitTerrainGidVec();\r\n    },\r\n\r\n    InitEnd: function(){\r\n        this.MapNode = null;\r\n    },\r\n\r\n    Reset: function(){\r\n        this.MapSize = null;\r\n        this.MapBlockSize = null;\r\n        this.MapBlockNum = null;\r\n        this.DoorGID = null;\r\n\r\n        if(this.MapTerrainGID){\r\n            this.MapTerrainGID.length = 0;\r\n            this.MapTerrainGID = null;\r\n        }\r\n        if(this.AppleGID){\r\n            this.AppleGID.length = 0;\r\n            this.AppleGID = null;\r\n        }\r\n        if(this.DiCiGID){\r\n            this.DiCiGID.length = 0;\r\n            this.DiCiGID = null;\r\n        }\r\n        if(this.StoneGID){\r\n            this.StoneGID.length = 0;\r\n            this.StoneGID = null;\r\n        }\r\n\r\n        if(this.StartGID){\r\n            this.StartGID.length = 0;\r\n            this.StartGID = null;\r\n        }\r\n\r\n        if(this.SnakeGID){\r\n            this.SnakeGID.length = 0;\r\n            this.SnakeGID = null;\r\n        }\r\n    },\r\n\r\n\r\n    InitTerrainGidVec: function(){\r\n        this.MapTerrainGID = [];\r\n        var allLayers = this.MapNode.allLayers();\r\n        for (var i = 0; i < allLayers.length; ++i) {\r\n            var layer = allLayers[i];\r\n\r\n            var allTiles= layer.getTiles();\r\n            for(var j = 0; j < allTiles.length; j ++){\r\n                if(allTiles[j] > 0){\r\n                    this.MapTerrainGID.push(j);\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    InitStoneGIDVec: function(){\r\n        this.StoneGID = [];\r\n        var index = 1;\r\n        while(true){\r\n            var gid = this.getGIDByName(\"stone_\" + index);\r\n            if(gid >= 0){\r\n                this.StoneGID.push(gid);\r\n                index ++;\r\n            }else{\r\n                break;\r\n            }\r\n        }\r\n                \r\n        var gid = this.getGIDByName(\"stone\");\r\n\r\n        if(gid >= 0){\r\n            this.StoneGID.push(gid);\r\n        }\r\n    },\r\n\r\n    InitDiCiGIDVec: function(){\r\n        this.DiCiGID = [];\r\n        var index = 1;\r\n\r\n        for(var direction = 1; direction <= 4; direction ++){\r\n            while(true){\r\n                var gid = this.getGIDByName(\"ci\" + direction + \"_\" + index);\r\n                if(gid >= 0){\r\n                    var gidobj = {\r\n                        gid: gid,\r\n                        direction: direction\r\n                    };\r\n                    this.DiCiGID.push(gidobj);\r\n                    index ++;\r\n                }else{\r\n                    index = 1;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        while(true){\r\n            var gid = this.getGIDByName(\"ci_\" + index);\r\n            if(gid >= 0){\r\n                var gidobj = {\r\n                    gid: gid,\r\n                    direction: 3\r\n                };\r\n                this.DiCiGID.push(gidobj);\r\n                index ++;\r\n            }else{\r\n                break;\r\n            }\r\n        }\r\n        \r\n        var gid = this.getGIDByName(\"ci\");\r\n\r\n        if(gid >= 0){\r\n            var gidobj = {\r\n                gid: gid,\r\n                direction: 2\r\n            };\r\n            this.DiCiGID.push(gidobj);\r\n        }\r\n    },\r\n\r\n    InitAppleGID: function(){\r\n        this.AppleGID = [];\r\n        var index = 1;\r\n        while(true){\r\n            var gid = this.getGIDByName(\"apple_\" + index);\r\n            if(gid >= 0){\r\n                this.AppleGID.push(gid);\r\n                index ++;\r\n            }else{\r\n                break;\r\n            }\r\n        }\r\n\r\n        var gid = this.getGIDByName(\"apple\");\r\n\r\n        if(gid >= 0){\r\n            this.AppleGID.push(gid);\r\n        }\r\n    },\r\n\r\n    InitDoorGID: function(){\r\n        this.DoorGID = this.getGIDByName(\"door\");\r\n    },\r\n\r\n    InitStartGID: function(){\r\n        this.StartGID = {};\r\n        this.SnakeGID = [];\r\n\r\n        this.StartGID.headGID = this.getGIDByName(\"startPos_1\");\r\n        this.StartGID.bodyGID = this.getGIDByName(\"startPos_2\");\r\n        this.StartGID.tailGID = this.getGIDByName(\"startPos_3\");\r\n\r\n        if(this.StartGID.headGID < 0){\r\n            this.StartGID.headGID = this.getGIDByName(\"startPos\");\r\n        }\r\n        if(this.StartGID.bodyGID < 0){\r\n            this.StartGID.bodyGID = this.StartGID.headGID - 1;\r\n        }\r\n        if(this.StartGID.tailGID < 0){\r\n            this.StartGID.tailGID = this.StartGID.bodyGID - 1;\r\n        }\r\n\r\n        this.SnakeGID.push(this.StartGID.headGID);\r\n        this.SnakeGID.push(this.StartGID.bodyGID);\r\n        this.SnakeGID.push(this.StartGID.tailGID);\r\n    },\r\n\r\n    //判断某个gid所在的图块是否为空\r\n    IsNull: function(gid){\r\n\r\n        if(this.DoorGID == gid){\r\n            return false;\r\n        }\r\n\r\n        if(Util.IsContainElement(this.AppleGID, gid)){\r\n            return false;\r\n        }\r\n\r\n        if(Util.IsContainElement(this.DiCiGID, gid)){\r\n            return false;\r\n        }\r\n\r\n        if(Util.IsContainElement(this.StoneGID, gid)){\r\n            return false;\r\n        }\r\n\r\n        // if(Util.IsContainElement(this.SnakeGID, gid)){\r\n        //     return false;\r\n        // }\r\n\r\n        return true;\r\n    },\r\n\r\n    RemoveTiled: function(gid){\r\n        if(!this.MapNode){\r\n            return;\r\n        }\r\n\r\n        var tid = this.ConvertGIDToTID(gid);\r\n\r\n        var allLayers = this.MapNode.allLayers();\r\n        for (var i = 0; i < allLayers.length; ++i) {\r\n            var layer = allLayers[i];\r\n\r\n            if(layer)\r\n            {\r\n                layer.removeTileAt(tid);\r\n            }\r\n        }\r\n    },\r\n\r\n    GetTiledSpriteFrame: function(gid){\r\n        if(!this.MapNode){\r\n            return null;\r\n        }\r\n\r\n        var tid = this.ConvertGIDToTID(gid);\r\n\r\n        var width = 52;\r\n        var height = 67;\r\n\r\n        var allLayers = this.MapNode.allLayers();\r\n        for (var i = 0; i < allLayers.length; ++i) {\r\n            var layer = allLayers[i];\r\n\r\n            var sprite = layer.getTileAt(tid);\r\n            var img_id = layer.getTileGIDAt(tid);\r\n\r\n            if(sprite && img_id > 0)\r\n            {\r\n                img_id -= 1;\r\n                sprite.color = new cc.Color(255,255,255,255);\r\n                if(img_id >= 7){\r\n                    img_id -= 7;\r\n                }\r\n                var url = sprite.getTexture().url;\r\n                var spriteFrame = new cc.SpriteFrame(url, new cc.Rect(width * img_id, 0, width, height));\r\n                var pos = this.ConvertGIDToPos(gid, cc.p(0.5, 0.5));\r\n                return {\r\n                    spriteFrame: spriteFrame,\r\n                    pos: cc.p(pos.x, pos.y)\r\n                };\r\n            }\r\n        }\r\n        return;\r\n    },\r\n    \r\n    ConvertMapYToCanvasY: function(mapY){\r\n        if(!this.MapSize){\r\n            return 0;\r\n        }\r\n        return this.MapSize.height - mapY;\r\n    },\r\n\r\n    ConvertTIDToGID: function(tid){\r\n        if(!this.MapBlockNum){\r\n            return 0;\r\n        }\r\n\r\n        return tid.y * this.MapBlockNum.width + tid.x;\r\n    },\r\n\r\n    ConvertGIDToTID: function(gid){\r\n        if(!this.MapBlockNum){\r\n            return cc.p();\r\n        }\r\n\r\n        var x = gid % this.MapBlockNum.width;\r\n        var y = parseInt(gid / this.MapBlockNum.width);\r\n        return cc.p(x, y);\r\n    },\r\n\r\n    ConvertPosToTid: function(pos){\r\n        if(!this.MapBlockSize || !this.MapSize){\r\n            return cc.p();\r\n        }\r\n\r\n        var tidX = parseInt(pos.x / this.MapBlockSize.width);\r\n        var tidY = parseInt((this.MapSize.height - pos.y) / this.MapBlockSize.height);\r\n\r\n        return cc.p(tidX, tidY);\r\n    },\r\n\r\n    ConvertMapPosToGID: function(pos){\r\n        if(!this.MapBlockSize){\r\n            return 0;\r\n        }\r\n\r\n        var tidX = parseInt(pos.x / this.MapBlockSize.width);\r\n        var tidY = parseInt(pos.y / this.MapBlockSize.height);\r\n\r\n        return this.ConvertTIDToGID(cc.p(tidX, tidY));\r\n    },\r\n\r\n    ConvertGIDToPos: function(gid, anchropoint){\r\n        if(!this.MapBlockSize){\r\n            return cc.p();\r\n        }\r\n\r\n        if(!anchropoint){\r\n            anchropoint = cc.p(0.5, 0.5);\r\n        }\r\n\r\n        var tid = this.ConvertGIDToTID(gid);\r\n\r\n        var posX = (tid.x + anchropoint.x) * this.MapBlockSize.width;\r\n        var posY = (tid.y + anchropoint.y) * this.MapBlockSize.height;\r\n        posY = this.ConvertMapYToCanvasY(posY);\r\n\r\n        return cc.p(posX, posY + 5);\r\n    },\r\n\r\n    GetMapTerrainGID: function(){\r\n        return this.MapTerrainGID;\r\n    },\r\n\r\n    GetNextGID: function(moveDirection, curGID){     \r\n        var nextTid = this.ConvertGIDToTID(curGID);\r\n                                                            \r\n        switch(moveDirection){\r\n            case MoveDirection.MD_Left:\r\n            {\r\n                nextTid.x --;\r\n                break;\r\n            }\r\n            case MoveDirection.MD_Right:\r\n            {\r\n                nextTid.x ++;\r\n                break;\r\n            }\r\n            case MoveDirection.MD_Up:\r\n            {\r\n                nextTid.y --;\r\n                break;\r\n            }\r\n            case MoveDirection.MD_Down:\r\n            {\r\n                nextTid.y ++;\r\n                break;\r\n            }\r\n        }\r\n        return this.ConvertTIDToGID(nextTid);\r\n    },\r\n    \r\n    RemoveAppleGID: function(appleGID){\r\n        if(this.AppleGID){\r\n            for(var i = 0;i < this.AppleGID.length;i ++){\r\n                if(appleGID == this.AppleGID[i]){\r\n                    this.AppleGID.splice(i, 1);\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    GetMapBlockNum: function(){\r\n        return this.MapBlockNum;\r\n    },\r\n\r\n    GetMapBlockSize: function(){\r\n        return this.MapBlockSize;\r\n    },\r\n\r\n    GetLeftGID: function(gid){\r\n        return gid - 1;\r\n    },\r\n\r\n    GetRightGID: function(gid){\r\n        return gid + 1;\r\n    },\r\n\r\n    GetUpGID: function(gid){\r\n        if(this.MapBlockNum){\r\n            return gid - this.MapBlockNum.width;\r\n        }\r\n        return -1;\r\n    },\r\n\r\n    GetDownGID: function(gid){\r\n        if(this.MapBlockNum){\r\n            return gid + this.MapBlockNum.width;\r\n        }\r\n        return -1;\r\n    },\r\n\r\n    GetDoorGID: function(){\r\n        return this.DoorGID;\r\n    },\r\n\r\n    GetAppleGID: function(){\r\n        return this.AppleGID;\r\n    },\r\n\r\n    GetStartGID: function(){\r\n        return this.StartGID;\r\n    },\r\n\r\n    GetAllStoneGID: function(){\r\n        return this.StoneGID;\r\n    },\r\n\r\n    GetSnakeGID: function(){\r\n        return this.SnakeGID;\r\n    },\r\n\r\n    GetDiCiGID: function(){\r\n        return this.DiCiGID;\r\n    },\r\n\r\n    GetProperty: function(objname, propertyname){\r\n        return this.getProperty(objname, propertyname);\r\n    },\r\n\r\n    UpdateStoneGID: function(allStoneGID){\r\n        this.StoneGID = allStoneGID;\r\n    },\r\n\r\n    UpdateSnakeGID: function(snakeGID){\r\n        this.SnakeGID = snakeGID;\r\n    },\r\n\r\n//私有方法\r\n    getGIDByName: function(name){\r\n        var gid = -1;\r\n        if(this.MapNode){\r\n            var objLayer = this.MapNode.getObjectGroup(\"objLayer\");\r\n            if(objLayer){\r\n                var posObj = objLayer.getObject(name);\r\n                if(posObj){\r\n                    var pos = cc.p(posObj.getProperty(\"x\"), posObj.getProperty(\"y\"));\r\n    \r\n                    var tidX = parseInt(pos.x / this.MapBlockSize.width);\r\n                    var tidY = parseInt(pos.y / this.MapBlockSize.height);\r\n    \r\n                    gid = this.ConvertTIDToGID(cc.p(tidX, tidY));\r\n                }\r\n            }\r\n        }\r\n        return gid;\r\n    },\r\n\r\n    getProperty: function(objname, propertyname){\r\n        if(this.MapNode){\r\n            var objLayer = this.MapNode.getObjectGroup(\"objLayer\");\r\n            if(objLayer){\r\n                var obj = objLayer.getObject(objname);\r\n                if(obj){\r\n                    var property = obj.getProperty(propertyname);\r\n                    return property;\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n    }\r\n};"]}