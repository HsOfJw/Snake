{"version":3,"sources":["WXHelper.js"],"names":["GlobalVar","require","WXHelper","userInfoBtn","IsWXContext","window","wx","undefined","Login","callback","self","userid","GameLocalData","ReadUserID","success","res","cc","log","code","fail","login","Share","canvas","game","width","winSize","height","toTempFilePath","x","y","destWidth","destHeight","shareAppMessage","title","Game","ShareText","imageUrl","tempFilePath","console","GetUseInfo","successCb","failCb","getUserInfo","withCredentials","fales","lang","UploadUserCloudStorage","data","setUserCloudStorage","KVDataList","complete","FetchFriendRankList","showShareMenu","withShareTicket","InitSharedCanvas","postMessage","messageType","Texture2D","GameOverRankList","curLevel","JJCYPlayer","openDataContext","getOpenDataContext","sharedCanvas","ClearSharedCanvas","CreateUserInfoButton","SystemInfo","modelWidth","windowWidth","modelHeight","windowHeight","buttonWidth","buttonHeight","buttonLeft","buttonTop","button","createUserInfoButton","type","image","style","left","top","onTap","DestroyUserInfoBtn","destroy","GetSystemInfo","getSystemInfoSync","MoreGame","configData","ReadConfigData","navigateToMiniProgram","appId","app_id","path","envVersion","ShowToast","showToast","module","exports"],"mappings":"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","file":"WXHelper.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["var GlobalVar = require(\"GlobalVar\");\r\n\r\nvar WXHelper = {\r\n\r\n    userInfoBtn: null,\r\n\r\n    IsWXContext: function(){\r\n        if (window.wx != undefined) {\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    Login: function(callback){\r\n        var self = this;\r\n\r\n        var userid = GameLocalData.ReadUserID();\r\n        if(userid){\r\n            //本地有userid不用登陆直接返回\r\n            callback(1);\r\n        }else{\r\n            if (window.wx != undefined) {\r\n                var success = function(res){\r\n                    cc.log(\"login success:resCode = \" + res.code);\r\n                    callback(2, res.code);\r\n                };\r\n                var fail = function(){\r\n                    cc.log(\"login fail\");\r\n                    callback(3);\r\n                };\r\n                wx.login({\r\n                    success: success,\r\n                    fail: fail\r\n                });\r\n            }else{\r\n                callback(19);\r\n            }\r\n        }\r\n    },\r\n\r\n    Share: function(callback){\r\n        cc.log(\"Share\");\r\n\r\n        if(WXHelper.IsWXContext() == false){\r\n            return;\r\n        }\r\n\r\n        var canvas = cc.game.canvas;\r\n        var width  = cc.winSize.width;\r\n        var height  = cc.winSize.height;\r\n        canvas.toTempFilePath({\r\n            x: 0,\r\n            y: 0,\r\n            width: width,\r\n            height: height,\r\n            destWidth: 500,\r\n            destHeight: 400,\r\n            success (res) {\r\n                if (window.wx != undefined) {\r\n                    window.wx.shareAppMessage({\r\n                        title: Game.GlobalVar.ShareText,\r\n                        imageUrl: res.tempFilePath,\r\n                        success: function(res){\r\n                            console.log(\"分享成功\");\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        })\r\n\r\n    },\r\n\r\n    GetUseInfo: function(successCb, failCb){\r\n        wx.getUserInfo({\r\n            withCredentials: fales,\r\n            lang: \"zh_CN\",\r\n            success: successCb,\r\n            fail: failCb\r\n        });\r\n    },\r\n\r\n    UploadUserCloudStorage: function(data){\r\n        cc.log(\"UploadUserCloudStorage\" + data);\r\n        \r\n        if (window.wx != undefined) {\r\n            wx.setUserCloudStorage({  \r\n                KVDataList: data,\r\n                success: function (res) {  \r\n                    console.log('setUserCloudStorage','success',res)  \r\n                },  \r\n                fail: function (res) {  \r\n                    console.log('setUserCloudStorage','fail')  \r\n                },  \r\n                complete: function (res) {  \r\n                    console.log('setUserCloudStorage','ok')  \r\n                }  \r\n            });\r\n        }\r\n    },\r\n\r\n    FetchFriendRankList: function(){\r\n        if (window.wx != undefined) {\r\n            window.wx.showShareMenu({withShareTicket: true});//设置分享按钮，方便获取群id展示群排行榜\r\n\r\n            WXHelper.InitSharedCanvas();\r\n\r\n            window.wx.postMessage({\r\n                messageType: 1\r\n            });\r\n\r\n            cc.log(\"发送消息到子域!--->>>展示好友排行榜\");\r\n\r\n            return new cc.Texture2D();\r\n        }\r\n    },\r\n\r\n    GameOverRankList: function(){\r\n        if(window.wx != undefined){\r\n            window.wx.showShareMenu({withShareTicket: true});//设置分享按钮，方便获取群id展示群排行榜\r\n\r\n            WXHelper.InitSharedCanvas();\r\n\r\n            window.wx.postMessage({\r\n                messageType: 2,\r\n                curLevel: Game.GlobalVar.curLevel,\r\n            });\r\n            cc.log(\"发送消息到子域!--->>>展示游戏结束界面排行榜\");\r\n\r\n            return new cc.Texture2D();\r\n        }\r\n    },\r\n\r\n    JJCYPlayer: function(){\r\n        if(window.wx != undefined){\r\n            window.wx.showShareMenu({withShareTicket: true});//设置分享按钮，方便获取群id展示群排行榜\r\n\r\n            WXHelper.InitSharedCanvas();\r\n\r\n            window.wx.postMessage({\r\n                messageType: 3,\r\n                curLevel: Game.GlobalVar.curLevel,\r\n            });\r\n\r\n            return new cc.Texture2D();\r\n        }\r\n    },\r\n\r\n    InitSharedCanvas: function(){\r\n        if (window.wx != undefined) {\r\n            var openDataContext = wx.getOpenDataContext();\r\n            var sharedCanvas = openDataContext.canvas;\r\n            if (sharedCanvas) {\r\n                sharedCanvas.width = cc.game.canvas.width * 2;\r\n                sharedCanvas.height = cc.game.canvas.height * 2;\r\n            }\r\n        }\r\n    },\r\n\r\n    ClearSharedCanvas: function(){\r\n        if (window.wx != undefined) {\r\n            var openDataContext = wx.getOpenDataContext();\r\n            var sharedCanvas = openDataContext.canvas;\r\n            if (sharedCanvas) {\r\n                sharedCanvas.width = 0;\r\n                sharedCanvas.height = 0;\r\n            }\r\n\r\n            window.wx.postMessage({\r\n                messageType: 4\r\n            });\r\n\r\n            cc.log(\"发送消息到子域!--->>>清理画布\");\r\n        }\r\n    },\r\n\r\n    CreateUserInfoButton: function(callback){\r\n        var self = this;\r\n\r\n        cc.log(\"CreateUserInfoButton\");\r\n\r\n        if (window.wx != undefined) {\r\n\r\n            if(Game.SystemInfo){\r\n                let modelWidth = Game.SystemInfo.windowWidth;\r\n                let modelHeight = Game.SystemInfo.windowHeight;\r\n                let buttonWidth = 364 * (modelWidth / (cc.winSize.width));\r\n                let buttonHeight = 126 * (modelHeight / (cc.winSize.height));\r\n                let buttonLeft = modelWidth / 2 - buttonWidth * 0.5;\r\n                let buttonTop = modelHeight * 0.5;\r\n    \r\n                let button = wx.createUserInfoButton({\r\n                    type: 'image ',\r\n                    image: 'http://gather.51weiwan.com//uploads//file//20180731//06fc14a09a16c33ce4b41e80d69e76fd.png',\r\n                    style: {\r\n                        left: buttonLeft,\r\n                        top: buttonTop,\r\n                        width: buttonWidth,\r\n                        height: buttonHeight,\r\n                    }\r\n                });\r\n    \r\n                button.onTap((res) => {\r\n                    callback(res);\r\n                });\r\n    \r\n                self.userInfoBtn = button;\r\n            }\r\n        }\r\n    },\r\n    \r\n    DestroyUserInfoBtn: function(){\r\n        if(this.userInfoBtn){\r\n            this.userInfoBtn.destroy();\r\n        }\r\n    },\r\n\r\n    GetSystemInfo: function(callback){\r\n        //调用微信接口 获取设备信息\r\n        if(Game.SystemInfo){\r\n            return;\r\n        }\r\n        if (window.wx != undefined) {\r\n            Game.SystemInfo = wx.getSystemInfoSync();\r\n        }\r\n    },\r\n\r\n    //更多游戏\r\n    MoreGame: function(){\r\n        if (window.wx != undefined) {\r\n            var configData = GameLocalData.ReadConfigData();\r\n            wx.navigateToMiniProgram({\r\n                appId: configData.app_id,\r\n                path: '',\r\n                envVersion: 'release',\r\n                success: function () {\r\n                    console.log(\"跳转到更多游戏成功\");\r\n                },\r\n                fail: function (res) {\r\n                    console.log(\"跳转到更多游戏失败\", res);\r\n                },\r\n            })\r\n        }\r\n\r\n    },\r\n    \r\n    ShowToast(title){\r\n        if(this.IsWXContext()){\r\n            wx.showToast({\r\n                title: title,\r\n            });\r\n        }\r\n    }\r\n};\r\n\r\n\r\nmodule.exports = WXHelper;"]}