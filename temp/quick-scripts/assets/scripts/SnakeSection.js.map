{"version":3,"sources":["SnakeSection.js"],"names":["SnakeNode","require","Util","MoveDirection","SnakeDirection","cc","Class","extends","newSprite","isFrist","ctor","gid","self","setName","sprite","spriteFrame","setTexture","url","raw","move","doMoveAction","moveFinish","direction","SD_Left_Up","SD_Left_Down","SD_Right_Down","SD_Right_Up","SpriteFrame","getNewSprite","active","doRotateAction","snakes","dropFinish","rotate","SD_Left","rotation","doTransfrom","SD_Up","SD_Down","SD_Right","newPos","Game","MapUtil","ConvertGIDToPos","nextGID","isChanged","x","director","getWinSize","width","parent","convertToNodeSpaceAR","position","zIndex","node","Node","addComponent","Sprite","addChild","changeParent","_super","setDirection","move_direction","preDirection"],"mappings":"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","file":"SnakeSection.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["var SnakeNode = require(\"SnakeNode\");\r\nvar Util = require(\"Util\");\r\nvar MoveDirection = require('ConstDefine').MoveDirection;\r\nvar SnakeDirection = require('ConstDefine').SnakeDirection;\r\n\r\ncc.Class({\r\n    extends: SnakeNode,\r\n\r\n    newSprite: null,\r\n\r\n    isFrist: null,\r\n\r\n    ctor(gid){\r\n        var self = this;\r\n\r\n        this.isFrist = false;\r\n        this.setName(\"SnakeSection\");\r\n        this.sprite.spriteFrame.setTexture(cc.url.raw('resources/gamescene/body.png'));\r\n\r\n\r\n    },\r\n\r\n    move(){\r\n        this.doMoveAction();\r\n    },\r\n\r\n    moveFinish(){\r\n        if(this.direction == SnakeDirection.SD_Left_Up || this.direction == SnakeDirection.SD_Left_Down || this.direction == SnakeDirection.SD_Right_Down || this.direction == SnakeDirection.SD_Right_Up){\r\n            this.sprite.spriteFrame = new cc.SpriteFrame(cc.url.raw(\"resources/gamescene/body_a.png\"));\r\n            var newSprite = this.getNewSprite();\r\n            if(newSprite){\r\n                newSprite.active = false;\r\n            }\r\n        }\r\n        this.doRotateAction();\r\n\r\n        if(this.isFrist){\r\n            this.snakes.moveFinish();\r\n        }\r\n    },\r\n    \r\n    dropFinish(){\r\n        var newSprite = this.getNewSprite();\r\n        if(newSprite){\r\n            newSprite.active = false;\r\n        }\r\n    },\r\n\r\n    doRotateAction: function(){\r\n        var rotate = 0;\r\n\r\n        if(this.direction == SnakeDirection.SD_Right_Down){\r\n            rotate = 180;\r\n        }else if(this.direction == SnakeDirection.SD_Left_Down){\r\n            rotate = 270;\r\n        }else if(this.direction == SnakeDirection.SD_Right_Up){\r\n            rotate = 90;\r\n        }else if(this.direction == SnakeDirection.SD_Left){\r\n            rotate = 180;\r\n        }\r\n\r\n        this.rotation = rotate;\r\n    },\r\n        \r\n    doTransfrom: function(){\r\n        if(this.direction == SnakeDirection.SD_Up || this.direction == SnakeDirection.SD_Down || this.direction == SnakeDirection.SD_Left || this.direction == SnakeDirection.SD_Right){\r\n            this.sprite.spriteFrame = new cc.SpriteFrame(cc.url.raw(\"resources/gamescene/body.png\"));\r\n        }else if(this.direction == SnakeDirection.SD_Left_Up){\r\n            var newSprite = this.getNewSprite();\r\n            if(newSprite){\r\n                var newPos = Game.MapUtil.ConvertGIDToPos(this.nextGID);\r\n                if(this.isChanged){\r\n                    newPos.x += (cc.director.getWinSize().width - 1334) * 0.5;\r\n                    newPos = this.parent.convertToNodeSpaceAR(newPos);\r\n                }\r\n                newSprite.rotation = 0;\r\n                newSprite.position = newPos;\r\n                newSprite.zIndex = this.zIndex;\r\n                newSprite.active = true;\r\n            }\r\n\r\n        }else if(this.direction == SnakeDirection.SD_Right_Down){\r\n            var newSprite = this.getNewSprite();\r\n            if(newSprite){\r\n                newSprite.rotation = 180;\r\n                var newPos = Game.MapUtil.ConvertGIDToPos(this.nextGID);\r\n                if(this.isChanged){\r\n                    newPos.x += (cc.director.getWinSize().width - 1334) * 0.5;\r\n                    newPos = this.parent.convertToNodeSpaceAR(newPos);\r\n                }\r\n                newSprite.position = newPos;\r\n                newSprite.active = true;\r\n                newSprite.zIndex = this.zIndex ;\r\n            }\r\n        }else if(this.direction == SnakeDirection.SD_Left_Down){\r\n            var newSprite = this.getNewSprite();\r\n            if(newSprite){\r\n                newSprite.rotation = 270;\r\n                var newPos = Game.MapUtil.ConvertGIDToPos(this.nextGID);\r\n                if(this.isChanged){\r\n                    newPos.x += (cc.director.getWinSize().width - 1334) * 0.5;\r\n                    newPos = this.parent.convertToNodeSpaceAR(newPos);\r\n                }\r\n                newSprite.position = newPos;\r\n                newSprite.active = true;\r\n                newSprite.zIndex = this.zIndex;\r\n            }\r\n        }else if(this.direction == SnakeDirection.SD_Right_Up){\r\n            var newSprite = this.getNewSprite();\r\n            if(newSprite){\r\n                newSprite.rotation = 90;\r\n                var newPos = Game.MapUtil.ConvertGIDToPos(this.nextGID);\r\n                if(this.isChanged){\r\n                    newPos.x += (cc.director.getWinSize().width - 1334) * 0.5;\r\n                    newPos = this.parent.convertToNodeSpaceAR(newPos);\r\n                }\r\n                newSprite.position = newPos;\r\n                newSprite.active = true;\r\n                newSprite.zIndex = this.zIndex;\r\n            }\r\n        }\r\n    },\r\n\r\n    getNewSprite: function(){\r\n        if(!this.newSprite){\r\n            var node = new cc.Node(\"Section_NewSprite\");\r\n            var sprite = node.addComponent(cc.Sprite);\r\n            sprite.spriteFrame = new cc.SpriteFrame(cc.url.raw(\"resources/gamescene/body_a.png\"));\r\n            this.parent.addChild(node);\r\n            this.newSprite = node;\r\n        }\r\n\r\n        return this.newSprite;\r\n    },\r\n\r\n    changeParent(parent){\r\n        this._super(parent);\r\n\r\n        var newSprite = this.getNewSprite();       \r\n        // var pos = newSprite.position;\r\n        // var newPos = parent.convertToNodeSpaceAR(pos);\r\n        // newSprite.position = newPos;\r\n        newSprite.parent = parent;\r\n    },\r\n\r\n    setDirection: function(move_direction){\r\n        this.preDirection = this.direction;\r\n        this.direction = move_direction;\r\n    },\r\n \r\n});"]}