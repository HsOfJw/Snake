{"version":3,"sources":["LockydrawLayer.js"],"names":["PropUtil","require","Util","LevelData","WXHelper","cc","Class","extends","Component","properties","returnBtn","Node","zpNode","feiqNode","getLayerNode","jtNode","receiveNode","showOffNode","flashingNode","jumpBtnNode","start","self","node","zIndex","GetCurLockydrawData","getComponent","Button","interactable","on","EventType","TOUCH_END","jtNodeClicked","receiveBtnClicked","showOffBtnClicked","returnBtnClicked","jumpBtnClicked","active","runAction","repeatForever","blink","GameConfig","LockydrawBlinkTime","show","off","Game","AudioManager","playButtonSound","startLockyDraw","log","receiveSuccessfulNode","getChildByName","delayTime","moveAction","moveTo","p","winSize","height","fadeAction","fadeIn","sequence","Share","propID","GetPropID","rotate","LockyDrawMinAngle","PropRotate","rotateAction","rotateTo","LockyDrawRotateTime","newAction","easing","easeSineOut","callFunc","lockydrawFinish","propid","UpdateCurLockydrawData","PropType","moneyImg","redPacketImg","playGetMoneySound","RedPacketNum","Yuan","openReaPacket","PropTextNode","moneynumNode","SetNodeText","PropList","randomNum","parseInt","Math","random","SetNodeTexture","RedPacketList"],"mappings":"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","file":"LockydrawLayer.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["var PropUtil = require(\"PropUtil\");\r\nvar Util = require(\"Util\");\r\nvar LevelData = require(\"LevelData\");\r\nvar WXHelper = require(\"WXHelper\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        returnBtn: cc.Node,\r\n        zpNode: cc.Node,\r\n        feiqNode: cc.Node,\r\n        getLayerNode: cc.Node,\r\n        jtNode: cc.Node,\r\n        receiveNode: cc.Node,\r\n        showOffNode: cc.Node,\r\n        flashingNode: cc.Node,\r\n        jumpBtnNode: cc.Node,\r\n    },\r\n\r\n    start () {\r\n        var self = this;\r\n\r\n        this.node.zIndex = 200;\r\n\r\n        if(LevelData.GetCurLockydrawData()){\r\n            this.jtNode.getComponent(cc.Button).interactable = false;\r\n        }else{\r\n            this.jtNode.getComponent(cc.Button).interactable = true;\r\n            this.jtNode.on(cc.Node.EventType.TOUCH_END, function(){\r\n                self.jtNodeClicked();\r\n            }); \r\n        }\r\n\r\n        this.receiveNode.on(cc.Node.EventType.TOUCH_END, function(){\r\n            self.receiveBtnClicked();\r\n        }); \r\n        this.showOffNode.on(cc.Node.EventType.TOUCH_END, function(){\r\n            self.showOffBtnClicked();\r\n        }); \r\n        this.returnBtn.on(cc.Node.EventType.TOUCH_END, function(){\r\n            self.returnBtnClicked();\r\n        }); \r\n        this.jumpBtnNode.on(cc.Node.EventType.TOUCH_END, function(){\r\n            self.jumpBtnClicked();\r\n        }); \r\n\r\n        this.node.active = false;\r\n        this.getLayerNode.active = false;\r\n\r\n        this.flashingNode.runAction(new cc.repeatForever(new cc.blink(GameConfig.LockydrawBlinkTime, 1)));\r\n    },\r\n\r\n    show(){\r\n        this.node.active = true;\r\n\r\n        if(LevelData.GetCurLockydrawData() == true){\r\n            this.jtNode.getComponent(cc.Button).interactable = false;\r\n            this.jtNode.off(cc.Node.EventType.TOUCH_END); \r\n        }\r\n    },\r\n\r\n    jtNodeClicked(){\r\n        Game.AudioManager.playButtonSound();\r\n\r\n        this.jtNode.getComponent(cc.Button).interactable = false;\r\n        this.jtNode.off(cc.Node.EventType.TOUCH_END); \r\n\r\n        this.startLockyDraw();\r\n    },\r\n\r\n    jumpBtnClicked(){\r\n        Game.AudioManager.playButtonSound();\r\n\r\n        this.getLayerNode.active = false;\r\n    },\r\n\r\n    receiveBtnClicked(){\r\n        Game.AudioManager.playButtonSound();\r\n\r\n        cc.log(\"receiveBtnClicked\");\r\n        \r\n        this.receiveNode.getComponent(cc.Button).interactable = false;\r\n        this.receiveNode.off(cc.Node.EventType.TOUCH_END); \r\n\r\n        var receiveSuccessfulNode = this.getLayerNode.getChildByName(\"ReceiveSuccessful\");\r\n        if(receiveSuccessfulNode){\r\n            var delayTime = new cc.delayTime(1);\r\n            var moveAction = new cc.moveTo(2, cc.p(0, cc.winSize.height));\r\n            var fadeAction = new cc.fadeIn(2);\r\n\r\n            receiveSuccessfulNode.runAction(cc.sequence(delayTime, moveAction, fadeAction));\r\n        }\r\n    },\r\n\r\n    showOffBtnClicked(){\r\n        Game.AudioManager.playButtonSound();\r\n\r\n        WXHelper.Share();\r\n\r\n        cc.log(\"showOffBtnClicked\");\r\n    },\r\n\r\n    returnBtnClicked(){\r\n        Game.AudioManager.playButtonSound();\r\n\r\n        cc.log(\"returnBtnClicked\");\r\n\r\n        this.node.active = false;\r\n    },\r\n\r\n    startLockyDraw(){\r\n        var self = this;\r\n\r\n        var propID = PropUtil.GetPropID();\r\n        var rotate = GameConfig.LockyDrawMinAngle + PropUtil.PropRotate[propID];\r\n        var rotateAction = new cc.rotateTo(GameConfig.LockyDrawRotateTime, rotate);\r\n        var newAction = rotateAction.easing(cc.easeSineOut(5));\r\n        var sequence = new cc.sequence(newAction, new cc.callFunc(function(){\r\n            self.lockydrawFinish(propID);\r\n        }));\r\n\r\n        this.zpNode.runAction(sequence);\r\n    },\r\n\r\n    lockydrawFinish(propid){\r\n        var self = this;\r\n\r\n        LevelData.UpdateCurLockydrawData(true);\r\n\r\n        if(PropUtil.PropType[propid] == 3){\r\n            this.feiqNode.active = true;\r\n        }else{\r\n            this.getLayerNode.active = true;\r\n\r\n            var moneyImg = this.getLayerNode.getChildByName(\"MoneyImg\");\r\n            var redPacketImg = this.getLayerNode.getChildByName(\"RedPagImg\");\r\n\r\n            moneyImg.active = (PropUtil.PropType[propid] == 1);\r\n            redPacketImg.active = (PropUtil.PropType[propid] == 2);\r\n\r\n            if(PropUtil.PropType[propid] == 2){\r\n                Game.AudioManager.playGetMoneySound();\r\n\r\n                var RedPacketNum = redPacketImg.getChildByName(\"RedPacketNum\");\r\n                var Yuan = redPacketImg.getChildByName(\"Yuan\");\r\n                if(RedPacketNum){\r\n                    RedPacketNum.active = false;\r\n                }\r\n                if(Yuan){\r\n                    Yuan.active = false;\r\n                }\r\n                redPacketImg.on(cc.Node.EventType.TOUCH_END, function(){\r\n                    self.openReaPacket();\r\n                });\r\n            }\r\n\r\n            if(PropUtil.PropType[propid] == 1){\r\n                Game.AudioManager.playGetMoneySound();\r\n\r\n                var PropTextNode = this.getLayerNode.getChildByName(\"PropText\");\r\n                var moneynumNode = PropTextNode.getChildByName(\"num\");\r\n                if(moneynumNode){\r\n                    Util.SetNodeText(moneynumNode, PropUtil.PropList[propid]);\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    openReaPacket(){\r\n        var redPacketImg = this.getLayerNode.getChildByName(\"RedPagImg\");\r\n        var RedPacketNum = redPacketImg.getChildByName(\"RedPacketNum\");\r\n        var Yuan = redPacketImg.getChildByName(\"Yuan\");\r\n\r\n        var randomNum = parseInt(Math.random() * 2);\r\n\r\n        RedPacketNum.active = true;\r\n        Yuan.active = true;\r\n\r\n        Util.SetNodeTexture(redPacketImg, \"resources/gamescene/gengduo.png\");\r\n        Util.SetNodeText(RedPacketNum, PropUtil.RedPacketList[randomNum]);\r\n    }\r\n\r\n    // update (dt) {},\r\n});\r\n"]}