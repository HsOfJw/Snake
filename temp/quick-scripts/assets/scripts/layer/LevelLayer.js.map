{"version":3,"sources":["LevelLayer.js"],"names":["GlobalVar","require","LevelData","AdvertiseMgr","AdvertiseConfig","WXHelper","cc","Class","extends","Component","properties","btnPrefab","Prefab","popUpPrefab","allBtn","onLoad","node","active","ReadChallengeCount","createBtn","refreshView","view","getChildByName","context","children","level_id","self","i","length","child","j","btn","instantiate","setTag","on","Node","EventType","TOUCH_END","event","levelBtnClicked","addChild","push","getTag","btnSprte","getComponent","Sprite","level_num","level_num_label","Label","IsLockedLevel","spriteFrame","SpriteFrame","url","raw","string","Game","AudioManager","playButtonSound","curTarget","currentTarget","tag","selectSceneCom","parent","pageView","scrollToRight","log","IsPlayedLevel","GetChallengeCount","popUpNode","addContext","show","IsWXContext","CreateVideoAd","ADConfig_Relive_Video","isFinish","SetChallengeCount","UseChallengeCount","curLevel","SceneMgr","switchScene","SceneType","LoadingScene","onDestroy"],"mappings":";;;;;;AAAA,IAAIA,YAAYC,QAAQ,WAAR,CAAhB;AACA,IAAIC,YAAYD,QAAQ,WAAR,CAAhB;AACA,IAAIE,eAAeF,QAAQ,cAAR,CAAnB;AACA,IAAIG,kBAAkBH,QAAQ,iBAAR,CAAtB;AACA,IAAII,WAAWJ,QAAQ,UAAR,CAAf;;AAEAK,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,mBAAWL,GAAGM,MADN;;AAGRC,qBAAaP,GAAGM;AAHR,KAHP;;AASLE,YAAQ,IATH;;AAWL;;AAEAC,UAbK,oBAaK;AACN,aAAKC,IAAL,CAAUC,MAAV,GAAmB,IAAnB;;AAEA;AACAf,kBAAUgB,kBAAV;;AAEA,aAAKC,SAAL;;AAEA,aAAKC,WAAL;AACH,KAtBI;AAwBLD,aAxBK,uBAwBM;AACP,YAAIE,OAAO,KAAKL,IAAL,CAAUM,cAAV,CAAyB,MAAzB,CAAX;AACA,YAAIC,UAAUF,KAAKC,cAAL,CAAoB,SAApB,CAAd;;AAEA,YAAIE,WAAWD,QAAQC,QAAvB;;AAEA,YAAIC,WAAW,CAAf;;AAEA,aAAKX,MAAL,GAAc,EAAd;;AAEA,YAAIY,OAAO,IAAX;AACA,aAAI,IAAIC,IAAI,CAAZ,EAAeA,IAAIH,SAASI,MAA5B,EAAoCD,GAApC,EAAwC;AACpC,gBAAIE,QAAQL,SAASG,CAAT,CAAZ;;AAEA,iBAAI,IAAIG,IAAI,CAAZ,EAAeA,KAAK,EAApB,EAAwBA,GAAxB,EAA4B;AACxB,oBAAIC,MAAMzB,GAAG0B,WAAH,CAAeN,KAAKf,SAApB,CAAV;AACAoB,oBAAIE,MAAJ,CAAWR,QAAX;AACA;AACAM,oBAAIG,EAAJ,CAAO5B,GAAG6B,IAAH,CAAQC,SAAR,CAAkBC,SAAzB,EAAmC,UAASC,KAAT,EAAe;AAC9CZ,yBAAKa,eAAL,CAAqBD,KAArB;AACH,iBAFD;AAGAT,sBAAMW,QAAN,CAAeT,GAAf;AACAN;;AAEA,qBAAKX,MAAL,CAAY2B,IAAZ,CAAiBV,GAAjB;AACH;AACJ;AACJ,KAnDI;AAqDLX,eArDK,yBAqDQ;AACT,YAAG,CAAC,KAAKN,MAAN,IAAgB,KAAKA,MAAL,CAAYc,MAAZ,IAAsB,CAAzC,EAA2C;AACvC;AACH;;AAED,aAAI,IAAID,IAAI,CAAZ,EAAcA,IAAI,KAAKb,MAAL,CAAYc,MAA9B,EAAqCD,GAArC,EAA0C;AACtC,gBAAII,MAAM,KAAKjB,MAAL,CAAYa,CAAZ,CAAV;;AAEA,gBAAG,CAACI,GAAJ,EAAQ;AACJ;AACH;;AAED,gBAAIN,WAAWM,IAAIW,MAAJ,EAAf;;AAEA,gBAAIC,WAAWZ,IAAIa,YAAJ,CAAiBtC,GAAGuC,MAApB,CAAf;AACA,gBAAIC,YAAYf,IAAIT,cAAJ,CAAmB,WAAnB,CAAhB;AACA,gBAAIyB,kBAAkBD,UAAUF,YAAV,CAAuBtC,GAAG0C,KAA1B,CAAtB;;AAEA,gBAAG9C,UAAU+C,aAAV,CAAwBxB,QAAxB,KAAqC,KAAxC,EAA8C;AAC1CqB,0BAAU7B,MAAV,GAAmB,KAAnB;AACA0B,yBAASO,WAAT,GAAuB,IAAI5C,GAAG6C,WAAP,CAAmB7C,GAAG8C,GAAH,CAAOC,GAAP,CAAW,sBAAX,CAAnB,CAAvB;AACH,aAHD,MAGK;AACDP,0BAAU7B,MAAV,GAAmB,IAAnB;AACA8B,gCAAgBO,MAAhB,GAAyB7B,QAAzB;AACH;AACJ;AACJ,KA/EI;;;AAiFL;AACAc,mBAlFK,2BAkFWD,KAlFX,EAkFiB;AAClBiB,aAAKC,YAAL,CAAkBC,eAAlB;;AAEA,YAAIC,YAAYpB,MAAMqB,aAAtB;;AAEA,YAAIlC,WAAWiC,UAAUE,GAAzB;;AAEA,YAAGnC,WAAW,EAAd,EAAiB;AACb,gBAAIoC,iBAAiB,KAAK7C,IAAL,CAAU8C,MAAV,CAAiBlB,YAAjB,CAA8B,aAA9B,CAArB;AACA,gBAAGiB,cAAH,EAAkB;AACdA,+BAAeE,QAAf,CAAwBC,aAAxB,CAAsC,CAAtC;AACH;AACJ;;AAED,YAAG9D,UAAU+C,aAAV,CAAwBxB,QAAxB,KAAqC,KAAxC,EAA8C;AAC1CnB,eAAG2D,GAAH,CAAO,OAAP;AACA;AACH;;AAED,YAAG/D,UAAUgE,aAAV,CAAwBzC,QAAxB,KAAqC,KAAxC,EAA8C;AAC1C;;AAEA,gBAAGvB,UAAUiE,iBAAV,MAAiC,CAApC,EAAsC;AAClC,oBAAG,KAAKtD,WAAR,EAAoB;AAChB,wBAAIuD,YAAY9D,GAAG0B,WAAH,CAAe,KAAKnB,WAApB,CAAhB;AACAuD,8BAAUxB,YAAV,CAAuB,YAAvB,EAAqCyB,UAArC,CAAgD,CAAhD;AACAD,8BAAUxB,YAAV,CAAuB,YAAvB,EAAqC0B,IAArC,CAA0C,YAAU;AAChD,4BAAGjE,SAASkE,WAAT,EAAH,EAA0B;AACtB;AACApE,yCAAaqE,aAAb,CAA2BpE,gBAAgBqE,qBAA3C,EAAkE,UAASC,QAAT,EAAkB;AAChF,oCAAGA,QAAH,EAAY;AACRxE,8CAAUyE,iBAAV,CAA4B,CAA5B;;AAEA;AACAzE,8CAAU0E,iBAAV;AACArB,yCAAKvD,SAAL,CAAe6E,QAAf,GAA0BpD,QAA1B;AACA8B,yCAAKuB,QAAL,CAAcC,WAAd,CAA0BxB,KAAKyB,SAAL,CAAeC,YAAzC;AACH;AACJ,6BATD;AAUH,yBAZD,MAYK;AACD/E,sCAAUyE,iBAAV,CAA4B,CAA5B;;AAEA;AACAzE,sCAAU0E,iBAAV;AACArB,iCAAKvD,SAAL,CAAe6E,QAAf,GAA0BpD,QAA1B;AACA8B,iCAAKuB,QAAL,CAAcC,WAAd,CAA0BxB,KAAKyB,SAAL,CAAeC,YAAzC;AACH;AAEJ,qBAtBD;AAuBA,yBAAKjE,IAAL,CAAUwB,QAAV,CAAmB4B,SAAnB,EAA8B,IAA9B;AACH;AACD;AACH;AACJ;;AAEDb,aAAKvD,SAAL,CAAe6E,QAAf,GAA0BpD,QAA1B;AACA8B,aAAKuB,QAAL,CAAcC,WAAd,CAA0BxB,KAAKyB,SAAL,CAAeC,YAAzC;AACH,KA3II;AA6ILC,aA7IK,uBA6IM;AACP,YAAG,KAAKpE,MAAR,EAAe;AACX,iBAAKA,MAAL,CAAYc,MAAZ,GAAqB,CAArB;AACH;AACJ;;AAED;;AAnJK,CAAT","file":"LevelLayer.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\layer","sourcesContent":["var GlobalVar = require(\"GlobalVar\");\r\nvar LevelData = require(\"LevelData\");\r\nvar AdvertiseMgr = require(\"AdvertiseMgr\");\r\nvar AdvertiseConfig = require(\"AdvertiseConfig\");\r\nvar WXHelper = require(\"WXHelper\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        btnPrefab: cc.Prefab,\r\n\r\n        popUpPrefab: cc.Prefab,\r\n    },\r\n\r\n    allBtn: null,\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        this.node.active = true;\r\n\r\n        //读取剩余挑战次数\r\n        LevelData.ReadChallengeCount();\r\n\r\n        this.createBtn();\r\n\r\n        this.refreshView();\r\n    },\r\n\r\n    createBtn(){\r\n        var view = this.node.getChildByName(\"view\");\r\n        var context = view.getChildByName(\"content\");\r\n\r\n        var children = context.children;\r\n\r\n        var level_id = 1;\r\n\r\n        this.allBtn = [];\r\n\r\n        var self = this;\r\n        for(var i = 0; i < children.length; i++){\r\n            var child = children[i];\r\n\r\n            for(var j = 1; j <= 15; j++){\r\n                var btn = cc.instantiate(self.btnPrefab);\r\n                btn.setTag(level_id);\r\n                // btn.getComponent(cc.Button).transition = cc.Button.Transition.NONE;\r\n                btn.on(cc.Node.EventType.TOUCH_END,function(event){\r\n                    self.levelBtnClicked(event);\r\n                });\r\n                child.addChild(btn);\r\n                level_id ++;\r\n\r\n                this.allBtn.push(btn);\r\n            }\r\n        }\r\n    },\r\n\r\n    refreshView(){\r\n        if(!this.allBtn || this.allBtn.length <= 0){\r\n            return;\r\n        }\r\n\r\n        for(var i = 0;i < this.allBtn.length;i ++){\r\n            var btn = this.allBtn[i];\r\n\r\n            if(!btn){\r\n                continue;\r\n            }\r\n\r\n            var level_id = btn.getTag();\r\n\r\n            var btnSprte = btn.getComponent(cc.Sprite);\r\n            var level_num = btn.getChildByName(\"level_num\");\r\n            var level_num_label = level_num.getComponent(cc.Label);\r\n\r\n            if(LevelData.IsLockedLevel(level_id) == false){\r\n                level_num.active = false;\r\n                btnSprte.spriteFrame = new cc.SpriteFrame(cc.url.raw('resources/unlock.png'));\r\n            }else{\r\n                level_num.active = true;\r\n                level_num_label.string = level_id;\r\n            }\r\n        }\r\n    },\r\n\r\n    //点击单个关卡\r\n    levelBtnClicked(event){\r\n        Game.AudioManager.playButtonSound();\r\n\r\n        var curTarget = event.currentTarget;\r\n\r\n        var level_id = curTarget.tag;\r\n\r\n        if(level_id > 15){\r\n            var selectSceneCom = this.node.parent.getComponent(\"SelectScene\");\r\n            if(selectSceneCom){\r\n                selectSceneCom.pageView.scrollToRight(0);\r\n            }\r\n        }\r\n\r\n        if(LevelData.IsLockedLevel(level_id) == false){\r\n            cc.log(\"关卡未解锁\");\r\n            return;\r\n        }\r\n\r\n        if(LevelData.IsPlayedLevel(level_id) == false){\r\n            //已解锁但未通关\r\n            \r\n            if(LevelData.GetChallengeCount() >= 5){\r\n                if(this.popUpPrefab){\r\n                    var popUpNode = cc.instantiate(this.popUpPrefab);\r\n                    popUpNode.getComponent(\"PopUpLayer\").addContext(1);\r\n                    popUpNode.getComponent(\"PopUpLayer\").show(function(){\r\n                        if(WXHelper.IsWXContext()){\r\n                            //创建视频广告\r\n                            AdvertiseMgr.CreateVideoAd(AdvertiseConfig.ADConfig_Relive_Video, function(isFinish){\r\n                                if(isFinish){\r\n                                    LevelData.SetChallengeCount(0);\r\n                                    \r\n                                    //添加挑战次数\r\n                                    LevelData.UseChallengeCount();\r\n                                    Game.GlobalVar.curLevel = level_id;\r\n                                    Game.SceneMgr.switchScene(Game.SceneType.LoadingScene);\r\n                                }\r\n                            });\r\n                        }else{\r\n                            LevelData.SetChallengeCount(0);\r\n                                    \r\n                            //添加挑战次数\r\n                            LevelData.UseChallengeCount();\r\n                            Game.GlobalVar.curLevel = level_id;\r\n                            Game.SceneMgr.switchScene(Game.SceneType.LoadingScene);\r\n                        }\r\n                        \r\n                    });\r\n                    this.node.addChild(popUpNode, 1000);\r\n                }\r\n                return;\r\n            }\r\n        }\r\n        \r\n        Game.GlobalVar.curLevel = level_id;\r\n        Game.SceneMgr.switchScene(Game.SceneType.LoadingScene);\r\n    },\r\n\r\n    onDestroy(){\r\n        if(this.allBtn){\r\n            this.allBtn.length = 0;\r\n        }\r\n    }\r\n    \r\n    // update (dt) {},\r\n});\r\n"]}