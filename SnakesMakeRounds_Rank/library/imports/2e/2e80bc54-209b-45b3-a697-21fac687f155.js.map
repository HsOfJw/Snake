{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\MainScene.js"],"names":["cc","Class","extends","Component","properties","fetchFriendRankList","Node","gameOverRankList","jjcyPlayer","onLoad","self","that","view","_convertPointWithScale","point","viewport","_viewPortRect","x","_scaleX","y","_scaleY","_convertTouchesWithScale","touches","scaleX","scaleY","selTouch","selPoint","selPrePoint","i","length","_point","_prevPoint","clearCanvas","start","active","log","window","wx","onMessage","data","messageType","showFetchFriendRankList","GlobalVar","curLevel","showGameOverRankList","showJJCYPlayer","fetchFriendCom","getComponent","show","winLayerRankCom","jjcyPlayerCom"],"mappings":"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","file":"MainScene.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        //好友排行榜\r\n        fetchFriendRankList: cc.Node,\r\n        //游戏结束界面排行榜\r\n        gameOverRankList: cc.Node,\r\n        //即将超越的玩家\r\n        jjcyPlayer: cc.Node,\r\n    },\r\n\r\n        \r\n    onLoad () {\r\n        var self = this;\r\n\r\n        var that = cc.view;\r\n\r\n        cc.view._convertPointWithScale = function(point) {\r\n            var viewport = that._viewPortRect;\r\n            point.x = (point.x - viewport.x) / (that._scaleX / 2);\r\n            point.y = (point.y - viewport.y) / (that._scaleY / 2);\r\n        };\r\n        cc.view._convertTouchesWithScale = function(touches) {\r\n            var viewport = that._viewPortRect, scaleX = that._scaleX / 2, scaleY = that._scaleY / 2, selTouch, selPoint, selPrePoint;\r\n            for (var i = 0; i < touches.length; i++) {\r\n                selTouch = touches[i];\r\n                selPoint = selTouch._point;\r\n                selPrePoint = selTouch._prevPoint;\r\n                selPoint.x = (selPoint.x - viewport.x) / scaleX;\r\n                selPoint.y = (selPoint.y - viewport.y) / scaleY;\r\n                selPrePoint.x = (selPrePoint.x - viewport.x) / scaleX;\r\n                selPrePoint.y = (selPrePoint.y - viewport.y) / scaleY;\r\n            }\r\n        };\r\n\r\n        this.clearCanvas();\r\n    },\r\n\r\n    start () {\r\n        var self = this;\r\n\r\n        if(this.fetchFriendRankList){\r\n            this.fetchFriendRankList.active = false;\r\n        }\r\n        if(this.gameOverRankList){\r\n            this.gameOverRankList.active = false;\r\n        }\r\n        if(this.jjcyPlayer){\r\n            this.jjcyPlayer.active = false;\r\n        }\r\n\r\n        cc.log(\"子域场景运行\");\r\n        \r\n        window.wx.onMessage(data => {\r\n            cc.log(\"接收主域发来消息：\", data);\r\n            \r\n            if(data.messageType == 1){\r\n                //好友排行榜\r\n                self.showFetchFriendRankList();\r\n            }else if(data.messageType == 2){\r\n                //胜利界面排行榜\r\n                GlobalVar.curLevel = data.curLevel;\r\n\r\n                self.showGameOverRankList();\r\n            }else if(data.messageType == 3){\r\n                //即将超越的玩家\r\n                GlobalVar.curLevel = data.curLevel;\r\n\r\n                self.showJJCYPlayer();\r\n            }else if(data.messageType == 4){\r\n                //清理画布\r\n                self.clearCanvas();\r\n            }\r\n        });\r\n    },\r\n\r\n    showFetchFriendRankList(){\r\n        this.jjcyPlayer.active = false;\r\n        this.gameOverRankList.active = false;\r\n\r\n        var fetchFriendCom = this.fetchFriendRankList.getComponent(\"RankListScene\");\r\n        if(fetchFriendCom){\r\n            fetchFriendCom.show();\r\n        }\r\n\r\n        this.fetchFriendRankList.active = true;\r\n    },\r\n\r\n    showGameOverRankList(){\r\n        this.fetchFriendRankList.active = false;\r\n        this.jjcyPlayer.active = false;\r\n\r\n        var winLayerRankCom = this.gameOverRankList.getComponent(\"WinLayerRank\");\r\n        if(winLayerRankCom){\r\n            winLayerRankCom.show();\r\n        }\r\n\r\n        this.gameOverRankList.active = true;\r\n    },\r\n\r\n    showJJCYPlayer(){\r\n        this.fetchFriendRankList.active = false;\r\n        this.gameOverRankList.active = false;\r\n\r\n        var jjcyPlayerCom = this.jjcyPlayer.getComponent(\"JJCYScene\");\r\n        if(jjcyPlayerCom){\r\n            jjcyPlayerCom.show();\r\n        }\r\n\r\n        this.jjcyPlayer.active = true;\r\n    },\r\n\r\n    clearCanvas(){\r\n        var winLayerRankCom = this.gameOverRankList.getComponent(\"WinLayerRank\");\r\n        if(winLayerRankCom){\r\n            winLayerRankCom.clearCanvas();\r\n        }\r\n\r\n        var jjcyPlayerCom = this.jjcyPlayer.getComponent(\"JJCYScene\");\r\n        if(jjcyPlayerCom){\r\n            jjcyPlayerCom.clearCanvas();\r\n        }\r\n\r\n        var fetchFriendCom = this.fetchFriendRankList.getComponent(\"RankListScene\");\r\n        if(fetchFriendCom){\r\n            fetchFriendCom.clearCanvas();\r\n        }\r\n    }\r\n});\r\n"]}