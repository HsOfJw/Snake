require=function i(r,o,s){function l(t,e){if(!o[t]){if(!r[t]){var a="function"==typeof require&&require;if(!e&&a)return a(t,!0);if(u)return u(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var c=o[t]={exports:{}};r[t][0].call(c.exports,function(e){return l(r[t][1][e]||e)},c,c.exports,i,r,o,s)}return o[t].exports}for(var u="function"==typeof require&&require,e=0;e<s.length;e++)l(s[e]);return l}({GlobalVar:[function(e,t,a){"use strict";cc._RF.push(t,"eab62DF6W1Kro/KJ020RJdC","GlobalVar"),window.GlobalVar={curLevel:1},cc._RF.pop()},{}],JJCYScene:[function(e,t,a){"use strict";cc._RF.push(t,"d69f6c6t7lHibXDdG6C9vk9","JJCYScene"),cc.Class({extends:cc.Component,properties:{jjcybg:cc.Node,jjcyheadImg:cc.Sprite,jjcyname:cc.Label,jjcytime:cc.Label},onLoad:function(){.1<cc.director.getWinSize().width/cc.director.getWinSize().height-16/9&&(this.node.scaleX=cc.director.getWinSize().width/1334)},show:function(){var n=this;wx.getFriendCloudStorage({keyList:["level_num","pass_time"],success:function(e){console.log("wx.getFriendCloudStorage success",e);var t=e.data,a=n.findData(t,GlobalVar.curLevel);n.initView(a)},fail:function(e){console.log("wx.getFriendCloudStorage fail",e),n.loadingLabel.getComponent(cc.Label).string="数据加载失败，请检测网络，谢谢。"}})},clearCanvas:function(){this.jjcybg.active=!1},findData:function(e,t){for(var a=t+1,n=Number.MAX_VALUE,c=-1,i=0;i<e.length;i++){var r=e[i],o=JSON.parse(r.KVDataList[0].value),s=JSON.parse(r.KVDataList[1].value);o.length<a-1||s.length<a-1||0==s[a-1]||s[a-1]<n&&(n=s[a-1],c=i)}return 0<=c?(e[c].mintime=n,e[c]):null},initView:function(e){e?(this.createImage(e.avatarUrl),this.setNodeText(this.jjcyname,e.nickname),this.setNodeText(this.jjcytime,e.mintime),this.jjcybg.active=!0):this.jjcybg.active=!1,this.jjcytime.active=!1},setNodeText:function(e,t){var a=e.getComponent(cc.Label);a&&(a.string=t)},createImage:function(e){var t=this;try{var a=wx.createImage();a.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(a),e.handleLoadedTexture(),t.jjcyheadImg.getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(e)}catch(e){cc.log(e),t.jjcyheadImg.active=!1}},a.src=e}catch(e){cc.log(e),t.node.active=!1}}}),cc._RF.pop()},{}],MainScene:[function(e,t,a){"use strict";cc._RF.push(t,"2e80bxUIJtFs6aXIfrGh/FV","MainScene"),cc.Class({extends:cc.Component,properties:{fetchFriendRankList:cc.Node,gameOverRankList:cc.Node,jjcyPlayer:cc.Node},onLoad:function(){var s=cc.view;cc.view._convertPointWithScale=function(e){var t=s._viewPortRect;e.x=(e.x-t.x)/(s._scaleX/2),e.y=(e.y-t.y)/(s._scaleY/2)},cc.view._convertTouchesWithScale=function(e){for(var t,a,n,c=s._viewPortRect,i=s._scaleX/2,r=s._scaleY/2,o=0;o<e.length;o++)a=(t=e[o])._point,n=t._prevPoint,a.x=(a.x-c.x)/i,a.y=(a.y-c.y)/r,n.x=(n.x-c.x)/i,n.y=(n.y-c.y)/r},this.clearCanvas()},start:function(){var t=this;this.fetchFriendRankList&&(this.fetchFriendRankList.active=!1),this.gameOverRankList&&(this.gameOverRankList.active=!1),this.jjcyPlayer&&(this.jjcyPlayer.active=!1),cc.log("子域场景运行"),window.wx.onMessage(function(e){cc.log("接收主域发来消息：",e),1==e.messageType?t.showFetchFriendRankList():2==e.messageType?(GlobalVar.curLevel=e.curLevel,t.showGameOverRankList()):3==e.messageType?(GlobalVar.curLevel=e.curLevel,t.showJJCYPlayer()):4==e.messageType&&t.clearCanvas()})},showFetchFriendRankList:function(){this.jjcyPlayer.active=!1,this.gameOverRankList.active=!1;var e=this.fetchFriendRankList.getComponent("RankListScene");e&&e.show(),this.fetchFriendRankList.active=!0},showGameOverRankList:function(){this.fetchFriendRankList.active=!1,this.jjcyPlayer.active=!1;var e=this.gameOverRankList.getComponent("WinLayerRank");e&&e.show(),this.gameOverRankList.active=!0},showJJCYPlayer:function(){this.fetchFriendRankList.active=!1,this.gameOverRankList.active=!1;var e=this.jjcyPlayer.getComponent("JJCYScene");e&&e.show(),this.jjcyPlayer.active=!0},clearCanvas:function(){var e=this.gameOverRankList.getComponent("WinLayerRank");e&&e.clearCanvas();var t=this.jjcyPlayer.getComponent("JJCYScene");t&&t.clearCanvas();var a=this.fetchFriendRankList.getComponent("RankListScene");a&&a.clearCanvas()}}),cc._RF.pop()},{}],RankItem:[function(e,t,a){"use strict";cc._RF.push(t,"3ca90WQYmlN/rZa9aXTzoZa","RankItem"),cc.Class({extends:cc.Component,properties:{bgImg:cc.Node,cupImg:cc.Node,headImg:cc.Node,playerName:cc.Node,time:cc.Node,cgNum:cc.Node,rankNum:cc.Node},start:function(){},initView:function(e,t,a){var n=this;e<=3?(this.cupImg.active=!0,this.rankNum.active=!1,cc.loader.load({url:cc.url.raw("resources/cup_"+e+".png"),type:"png"},function(e,t){n.cupImg.getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(t)})):(this.rankNum.active=!0,this.cupImg.active=!1,this.setNodeText(this.rankNum,e)),a&&cc.loader.load({url:cc.url.raw("resources/mybar.png"),type:"png"},function(e,t){n.bgImg.getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(t)}),this.createImage(t.avatarUrl),this.setNodeText(this.playerName,t.nickname),this.setNodeText(this.time,t.total_pass_time),this.setNodeText(this.cgNum,t.level_num)},setNodeText:function(e,t){var a=e.getComponent(cc.Label);a&&(a.string=t)},setNodeTexture:function(e,t){var a=e.getComponent(cc.Sprite);a&&a.spriteFrame.setTexture(cc.url.raw(t))},createImage:function(e){var t=this;try{var a=wx.createImage();a.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(a),e.handleLoadedTexture(),t.headImg.getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(e)}catch(e){cc.log(e),t.headImg.active=!1}},a.src=e}catch(e){cc.log(e),this.node.active=!1}}}),cc._RF.pop()},{}],RankListScene:[function(e,t,a){"use strict";cc._RF.push(t,"93ba9MFQmJGfpic8EWbFI/7","RankListScene"),cc.Class({extends:cc.Component,properties:{rankingScrollView:cc.ScrollView,scrollViewContent:cc.Node,prefabRankItem:cc.Prefab},myrank:null,show:function(){this.fetchFriendData()},clearCanvas:function(){this.removeChild()},removeChild:function(){this.node.removeChildByTag(1e3),this.scrollViewContent.removeAllChildren(),this.rankingScrollView.node.active=!1},fetchFriendData:function(){var l=this;this.rankingScrollView.node.active=!0,wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){console.log("success",e.data);var s=e.data[0];wx.getFriendCloudStorage({keyList:["level_num","pass_time"],success:function(e){console.log("wx.getFriendCloudStorage success",e);for(var t=e.data,a=(l.dataSort(t),0);a<t.length&&!(10<=a);a++){var n=t[a],c=cc.instantiate(l.prefabRankItem),i=c.getComponent("RankItem");i&&i.initView(a+1,n),l.scrollViewContent.addChild(c),c.y=-140*a}var r=l.getSelfData(t,s);if(r){var o=cc.instantiate(l.prefabRankItem);o.getComponent("RankItem").initView(l.myrank,r,!0),o.y=-200,l.node.addChild(o,1,1e3)}},fail:function(e){console.log("wx.getFriendCloudStorage fail",e),l.loadingLabel.getComponent(cc.Label).string="数据加载失败，请检测网络，谢谢。"}})},fail:function(e){l.loadingLabel.getComponent(cc.Label).string="数据加载失败，请检测网络，谢谢。"}})},dataSort:function(e){for(var t=0;t<e.length;t++){var a=e[t],n=JSON.parse(a.KVDataList[0].value),c=JSON.parse(a.KVDataList[1].value);a.level_num=n.length;for(var i=a.total_pass_time=0;i<c.length;i++)a.total_pass_time+=c[i]}e.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.level_num!=e.level_num?t.level_num-e.level_num:e.total_pass_time-t.total_pass_time})},getSelfData:function(e,t){for(var a=0;a<e.length;a++)if(e[a].avatarUrl==t.avatarUrl)return this.myrank=a+1,e[a];return null}}),cc._RF.pop()},{}],WinLayerRankItem:[function(e,t,a){"use strict";cc._RF.push(t,"59ddbfHcZZKH46DI0Hf/IFs","WinLayerRankItem"),cc.Class({extends:cc.Component,properties:{cupImg:cc.Node,headImg:cc.Node,playerName:cc.Node,time:cc.Node,rankNum:cc.Node,bg:cc.Node},start:function(){},initView:function(e,t,a){var n=this;e<=3?(this.cupImg.active=!0,this.rankNum.active=!1,cc.loader.load({url:cc.url.raw("resources/winlayer_cup_"+e+".png"),type:"png"},function(e,t){n.cupImg.getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(t)})):(this.rankNum.active=!0,this.cupImg.active=!1,this.setNodeText(this.rankNum,e)),this.bg.active=a,this.createImage(t.avatarUrl),this.setNodeText(this.playerName,t.nickname),this.setNodeText(this.time,t.curLevelMinTime)},setNodeText:function(e,t){var a=e.getComponent(cc.Label);a&&(a.string=t)},setNodeTexture:function(e,t){var a=e.getComponent(cc.Sprite);a&&a.spriteFrame.setTexture(cc.url.raw(t))},createImage:function(e){var t=this;try{var a=wx.createImage();a.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(a),e.handleLoadedTexture(),t.headImg.getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(e)}catch(e){cc.log(e),t.headImg.active=!1}},a.src=e}catch(e){cc.log(e),this.node.active=!1}}}),cc._RF.pop()},{}],WinLayerRank:[function(e,t,a){"use strict";cc._RF.push(t,"5c426arGflHTLGE6eMdnyqY","WinLayerRank"),cc.Class({extends:cc.Component,properties:{rankingScrollView:cc.ScrollView,scrollViewContent:cc.Node,prefabRankItem:cc.Prefab},myrank:null,show:function(){this.fetchFriendData()},clearCanvas:function(){this.removeChild()},removeChild:function(){this.node.removeChildByTag(1e3),this.scrollViewContent.removeAllChildren(),this.rankingScrollView.node.active=!1},fetchFriendData:function(){var u=this;u.rankingScrollView.node.active=!0,wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){console.log("getUserInfo success",e.data);var l=e.data[0];wx.getFriendCloudStorage({keyList:["level_num","pass_time"],success:function(e){console.log("所有好友的托管数据",e);var t=e.data,a=u.dataSort(t);console.log("排序后的数据",a);for(var n=0;n<a.length&&!(10<=n);n++){var c=a[n],i=cc.instantiate(u.prefabRankItem),r=i.getComponent("WinLayerRankItem");r&&r.initView(n+1,c,!1),u.scrollViewContent.addChild(i),i.y=-60*n}var o=u.getSelfData(a,l);if(o){var s=cc.instantiate(u.prefabRankItem);s.getComponent("WinLayerRankItem").initView(u.myrank,o,!0),s.y=-170,u.node.addChild(s,1,1e3)}},fail:function(e){console.log("wx.getFriendCloudStorage fail",e),u.loadingLabel.getComponent(cc.Label).string="数据加载失败，请检测网络，谢谢。"}})},fail:function(e){u.loadingLabel.getComponent(cc.Label).string="数据加载失败，请检测网络，谢谢。"}})},dataSort:function(e){for(var t=[],a=0;a<e.length;a++){var n=e[a],c=(JSON.parse(n.KVDataList[0].value),JSON.parse(n.KVDataList[1].value));0!=c[GlobalVar.curLevel-1]&&(c.length>=GlobalVar.curLevel&&(n.curLevelMinTime=c[GlobalVar.curLevel-1],t.push(n)))}return t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:e.curLevelMinTime-t.curLevelMinTime}),t},getSelfData:function(e,t){for(var a=0;a<e.length;a++)if(e[a].avatarUrl==t.avatarUrl)return this.myrank=a+1,e[a];return null}}),cc._RF.pop()},{}]},{},["GlobalVar","JJCYScene","MainScene","RankItem","RankListScene","WinLayerRank","WinLayerRankItem"]);